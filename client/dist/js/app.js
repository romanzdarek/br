/*! For license information please see app.js.LICENSE.txt */
(()=>{var e={766:(e,t,n)=>{var s;!function(){"use strict";var i=function(){this.init()};i.prototype={init:function(){var e=this||a;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var t=this||a;if(e=parseFloat(e),t.ctx||m(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,a.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var s=t._howls[n]._getSoundIds(),i=0;i<s.length;i++){var o=t._howls[n]._soundById(s[i]);o&&o._node&&(o._node.volume=o._volume*e)}return t}return t._volume},mute:function(e){var t=this||a;t.ctx||m(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,a.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var s=t._howls[n]._getSoundIds(),i=0;i<s.length;i++){var o=t._howls[n]._soundById(s[i]);o&&o._node&&(o._node.muted=!!e||o._muted)}return t},stop:function(){for(var e=this||a,t=0;t<e._howls.length;t++)e._howls[t].stop();return e},unload:function(){for(var e=this||a,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,m()),e},codecs:function(e){return(this||a)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||a;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||a,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!t||"function"!=typeof t.canPlayType)return e;var n=t.canPlayType("audio/mpeg;").replace(/^no$/,""),s=e._navigator?e._navigator.userAgent:"",i=s.match(/OPR\/([0-6].)/g),o=i&&parseInt(i[0].split("/")[1],10)<33,r=-1!==s.indexOf("Safari")&&-1===s.indexOf("Chrome"),l=s.match(/Version\/(.*?) /),h=r&&l&&parseInt(l[1],10)<15;return e._codecs={mp3:!(o||!n&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!n,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(t.canPlayType('audio/wav; codecs="1"')||t.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(t.canPlayType("audio/x-m4b;")||t.canPlayType("audio/m4b;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(h||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(h||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||a;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var t=function(n){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var s=new Audio;s._unlocked=!0,e._releaseHtml5Audio(s)}catch(n){e.noAudio=!0;break}for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var a=e._howls[i]._getSoundIds(),o=0;o<a.length;o++){var r=e._howls[i]._soundById(a[o]);r&&r._node&&!r._node._unlocked&&(r._node._unlocked=!0,r._node.load())}e._autoResume();var l=e.ctx.createBufferSource();l.buffer=e._scratchBuffer,l.connect(e.ctx.destination),void 0===l.start?l.noteOn(0):l.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),l.onended=function(){l.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0),document.removeEventListener("keydown",t,!0);for(var n=0;n<e._howls.length;n++)e._howls[n]._emit("unlock")}};return document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("click",t,!0),document.addEventListener("keydown",t,!0),e}},_obtainHtml5Audio:function(){var e=this||a;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var t=(new Audio).play();return t&&"undefined"!=typeof Promise&&(t instanceof Promise||"function"==typeof t.then)&&t.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var t=this||a;return e._unlocked&&t._html5AudioPool.push(e),t},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&a.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var n=0;n<e._howls[t]._sounds.length;n++)if(!e._howls[t]._sounds[n]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&a.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var a=new i,o=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};o.prototype={init:function(e){var t=this;return a.ctx||m(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onunlock=e.onunlock?[{fn:e.onunlock}]:[],t._onresume=[],t._webAudio=a.usingWebAudio&&!t._html5,void 0!==a.ctx&&a.ctx&&a.autoUnlock&&a._unlockAudio(),a._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&"none"!==t._preload&&t.load(),t},load:function(){var e=this,t=null;if(a.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(var n=0;n<e._src.length;n++){var s,i;if(e._format&&e._format[n])s=e._format[n];else{if("string"!=typeof(i=e._src[n])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(s=/^data:audio\/([^;,]+);/i.exec(i))||(s=/\.([^.]+)$/.exec(i.split("?",1)[0])),s&&(s=s[1].toLowerCase())}if(s||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),s&&a.codecs(s)){t=e._src[n];break}}if(t)return e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new r(e),e._webAudio&&h(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,t){var n=this,s=null;if("number"==typeof e)s=e,e=null;else{if("string"==typeof e&&"loaded"===n._state&&!n._sprite[e])return null;if(void 0===e&&(e="__default",!n._playLock)){for(var i=0,o=0;o<n._sounds.length;o++)n._sounds[o]._paused&&!n._sounds[o]._ended&&(i++,s=n._sounds[o]._id);1===i?e=null:s=null}}var r=s?n._soundById(s):n._inactiveSound();if(!r)return null;if(s&&!e&&(e=r._sprite||"__default"),"loaded"!==n._state){r._sprite=e,r._ended=!1;var l=r._id;return n._queue.push({event:"play",action:function(){n.play(l)}}),l}if(s&&!r._paused)return t||n._loadQueue("play"),r._id;n._webAudio&&a._autoResume();var h=Math.max(0,r._seek>0?r._seek:n._sprite[e][0]/1e3),c=Math.max(0,(n._sprite[e][0]+n._sprite[e][1])/1e3-h),d=1e3*c/Math.abs(r._rate),u=n._sprite[e][0]/1e3,m=(n._sprite[e][0]+n._sprite[e][1])/1e3;r._sprite=e,r._ended=!1;var p=function(){r._paused=!1,r._seek=h,r._start=u,r._stop=m,r._loop=!(!r._loop&&!n._sprite[e][2])};if(!(h>=m)){var g=r._node;if(n._webAudio){var y=function(){n._playLock=!1,p(),n._refreshBuffer(r);var e=r._muted||n._muted?0:r._volume;g.gain.setValueAtTime(e,a.ctx.currentTime),r._playStart=a.ctx.currentTime,void 0===g.bufferSource.start?r._loop?g.bufferSource.noteGrainOn(0,h,86400):g.bufferSource.noteGrainOn(0,h,c):r._loop?g.bufferSource.start(0,h,86400):g.bufferSource.start(0,h,c),d!==1/0&&(n._endTimers[r._id]=setTimeout(n._ended.bind(n,r),d)),t||setTimeout((function(){n._emit("play",r._id),n._loadQueue()}),0)};"running"===a.state&&"interrupted"!==a.ctx.state?y():(n._playLock=!0,n.once("resume",y),n._clearTimer(r._id))}else{var f=function(){g.currentTime=h,g.muted=r._muted||n._muted||a._muted||g.muted,g.volume=r._volume*a.volume(),g.playbackRate=r._rate;try{var s=g.play();if(s&&"undefined"!=typeof Promise&&(s instanceof Promise||"function"==typeof s.then)?(n._playLock=!0,p(),s.then((function(){n._playLock=!1,g._unlocked=!0,t?n._loadQueue():n._emit("play",r._id)})).catch((function(){n._playLock=!1,n._emit("playerror",r._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),r._ended=!0,r._paused=!0}))):t||(n._playLock=!1,p(),n._emit("play",r._id)),g.playbackRate=r._rate,g.paused)return void n._emit("playerror",r._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||r._loop?n._endTimers[r._id]=setTimeout(n._ended.bind(n,r),d):(n._endTimers[r._id]=function(){n._ended(r),g.removeEventListener("ended",n._endTimers[r._id],!1)},g.addEventListener("ended",n._endTimers[r._id],!1))}catch(e){n._emit("playerror",r._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===g.src&&(g.src=n._src,g.load());var _=window&&window.ejecta||!g.readyState&&a._navigator.isCocoonJS;if(g.readyState>=3||_)f();else{n._playLock=!0,n._state="loading";var w=function(){n._state="loaded",f(),g.removeEventListener(a._canPlayEvent,w,!1)};g.addEventListener(a._canPlayEvent,w,!1),n._clearTimer(r._id)}}return r._id}n._ended(r)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var n=t._getSoundIds(e),s=0;s<n.length;s++){t._clearTimer(n[s]);var i=t._soundById(n[s]);if(i&&!i._paused&&(i._seek=t.seek(n[s]),i._rateSeek=0,i._paused=!0,t._stopFade(n[s]),i._node))if(t._webAudio){if(!i._node.bufferSource)continue;void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),t._cleanBuffer(i._node)}else isNaN(i._node.duration)&&i._node.duration!==1/0||i._node.pause();arguments[1]||t._emit("pause",i?i._id:null)}return t},stop:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"stop",action:function(){n.stop(e)}}),n;for(var s=n._getSoundIds(e),i=0;i<s.length;i++){n._clearTimer(s[i]);var a=n._soundById(s[i]);a&&(a._seek=a._start||0,a._rateSeek=0,a._paused=!0,a._ended=!0,n._stopFade(s[i]),a._node&&(n._webAudio?a._node.bufferSource&&(void 0===a._node.bufferSource.stop?a._node.bufferSource.noteOff(0):a._node.bufferSource.stop(0),n._cleanBuffer(a._node)):isNaN(a._node.duration)&&a._node.duration!==1/0||(a._node.currentTime=a._start||0,a._node.pause(),a._node.duration===1/0&&n._clearSound(a._node))),t||n._emit("stop",a._id))}return n},mute:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"mute",action:function(){n.mute(e,t)}}),n;if(void 0===t){if("boolean"!=typeof e)return n._muted;n._muted=e}for(var s=n._getSoundIds(t),i=0;i<s.length;i++){var o=n._soundById(s[i]);o&&(o._muted=e,o._interval&&n._stopFade(o._id),n._webAudio&&o._node?o._node.gain.setValueAtTime(e?0:o._volume,a.ctx.currentTime):o._node&&(o._node.muted=!!a._muted||e),n._emit("mute",o._id))}return n},volume:function(){var e,t,n,s=this,i=arguments;if(0===i.length)return s._volume;if(1===i.length||2===i.length&&void 0===i[1]){var o=s._getSoundIds(),r=o.indexOf(i[0]);r>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else i.length>=2&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if(!(void 0!==e&&e>=0&&e<=1))return(n=t?s._soundById(t):s._sounds[0])?n._volume:0;if("loaded"!==s._state||s._playLock)return s._queue.push({event:"volume",action:function(){s.volume.apply(s,i)}}),s;void 0===t&&(s._volume=e),t=s._getSoundIds(t);for(var l=0;l<t.length;l++)(n=s._soundById(t[l]))&&(n._volume=e,i[2]||s._stopFade(t[l]),s._webAudio&&n._node&&!n._muted?n._node.gain.setValueAtTime(e,a.ctx.currentTime):n._node&&!n._muted&&(n._node.volume=e*a.volume()),s._emit("volume",n._id));return s},fade:function(e,t,n,s){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"fade",action:function(){i.fade(e,t,n,s)}}),i;e=Math.min(Math.max(0,parseFloat(e)),1),t=Math.min(Math.max(0,parseFloat(t)),1),n=parseFloat(n),i.volume(e,s);for(var o=i._getSoundIds(s),r=0;r<o.length;r++){var l=i._soundById(o[r]);if(l){if(s||i._stopFade(o[r]),i._webAudio&&!l._muted){var h=a.ctx.currentTime,c=h+n/1e3;l._volume=e,l._node.gain.setValueAtTime(e,h),l._node.gain.linearRampToValueAtTime(t,c)}i._startFadeInterval(l,e,t,n,o[r],void 0===s)}}return i},_startFadeInterval:function(e,t,n,s,i,a){var o=this,r=t,l=n-t,h=Math.abs(l/.01),c=Math.max(4,h>0?s/h:s),d=Date.now();e._fadeTo=n,e._interval=setInterval((function(){var i=(Date.now()-d)/s;d=Date.now(),r+=l*i,r=Math.round(100*r)/100,r=l<0?Math.max(n,r):Math.min(n,r),o._webAudio?e._volume=r:o.volume(r,e._id,!0),a&&(o._volume=r),(n<t&&r<=n||n>t&&r>=n)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,o.volume(n,e._id),o._emit("fade",e._id))}),c)},_stopFade:function(e){var t=this,n=t._soundById(e);return n&&n._interval&&(t._webAudio&&n._node.gain.cancelScheduledValues(a.ctx.currentTime),clearInterval(n._interval),n._interval=null,t.volume(n._fadeTo,e),n._fadeTo=null,t._emit("fade",e)),t},loop:function(){var e,t,n,s=this,i=arguments;if(0===i.length)return s._loop;if(1===i.length){if("boolean"!=typeof i[0])return!!(n=s._soundById(parseInt(i[0],10)))&&n._loop;e=i[0],s._loop=e}else 2===i.length&&(e=i[0],t=parseInt(i[1],10));for(var a=s._getSoundIds(t),o=0;o<a.length;o++)(n=s._soundById(a[o]))&&(n._loop=e,s._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=e,e&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop,s.playing(a[o])&&(s.pause(a[o],!0),s.play(a[o],!0)))));return s},rate:function(){var e,t,n,s=this,i=arguments;if(0===i.length)t=s._sounds[0]._id;else if(1===i.length){var o=s._getSoundIds(),r=o.indexOf(i[0]);r>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else 2===i.length&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if("number"!=typeof e)return(n=s._soundById(t))?n._rate:s._rate;if("loaded"!==s._state||s._playLock)return s._queue.push({event:"rate",action:function(){s.rate.apply(s,i)}}),s;void 0===t&&(s._rate=e),t=s._getSoundIds(t);for(var l=0;l<t.length;l++)if(n=s._soundById(t[l])){s.playing(t[l])&&(n._rateSeek=s.seek(t[l]),n._playStart=s._webAudio?a.ctx.currentTime:n._playStart),n._rate=e,s._webAudio&&n._node&&n._node.bufferSource?n._node.bufferSource.playbackRate.setValueAtTime(e,a.ctx.currentTime):n._node&&(n._node.playbackRate=e);var h=s.seek(t[l]),c=(s._sprite[n._sprite][0]+s._sprite[n._sprite][1])/1e3-h,d=1e3*c/Math.abs(n._rate);!s._endTimers[t[l]]&&n._paused||(s._clearTimer(t[l]),s._endTimers[t[l]]=setTimeout(s._ended.bind(s,n),d)),s._emit("rate",n._id)}return s},seek:function(){var e,t,n=this,s=arguments;if(0===s.length)n._sounds.length&&(t=n._sounds[0]._id);else if(1===s.length){var i=n._getSoundIds(),o=i.indexOf(s[0]);o>=0?t=parseInt(s[0],10):n._sounds.length&&(t=n._sounds[0]._id,e=parseFloat(s[0]))}else 2===s.length&&(e=parseFloat(s[0]),t=parseInt(s[1],10));if(void 0===t)return 0;if("number"==typeof e&&("loaded"!==n._state||n._playLock))return n._queue.push({event:"seek",action:function(){n.seek.apply(n,s)}}),n;var r=n._soundById(t);if(r){if(!("number"==typeof e&&e>=0)){if(n._webAudio){var l=n.playing(t)?a.ctx.currentTime-r._playStart:0,h=r._rateSeek?r._rateSeek-r._seek:0;return r._seek+(h+l*Math.abs(r._rate))}return r._node.currentTime}var c=n.playing(t);c&&n.pause(t,!0),r._seek=e,r._ended=!1,n._clearTimer(t),n._webAudio||!r._node||isNaN(r._node.duration)||(r._node.currentTime=e);var d=function(){c&&n.play(t,!0),n._emit("seek",t)};if(c&&!n._webAudio){var u=function(){n._playLock?setTimeout(u,0):d()};setTimeout(u,0)}else d()}return n},playing:function(e){var t=this;if("number"==typeof e){var n=t._soundById(e);return!!n&&!n._paused}for(var s=0;s<t._sounds.length;s++)if(!t._sounds[s]._paused)return!0;return!1},duration:function(e){var t=this,n=t._duration,s=t._soundById(e);return s&&(n=t._sprite[s._sprite][1]/1e3),n},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,n=0;n<t.length;n++)t[n]._paused||e.stop(t[n]._id),e._webAudio||(e._clearSound(t[n]._node),t[n]._node.removeEventListener("error",t[n]._errorFn,!1),t[n]._node.removeEventListener(a._canPlayEvent,t[n]._loadFn,!1),t[n]._node.removeEventListener("ended",t[n]._endFn,!1),a._releaseHtml5Audio(t[n]._node)),delete t[n]._node,e._clearTimer(t[n]._id);var s=a._howls.indexOf(e);s>=0&&a._howls.splice(s,1);var i=!0;for(n=0;n<a._howls.length;n++)if(a._howls[n]._src===e._src||e._src.indexOf(a._howls[n]._src)>=0){i=!1;break}return l&&i&&delete l[e._src],a.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,n,s){var i=this["_on"+e];return"function"==typeof t&&i.push(s?{id:n,fn:t,once:s}:{id:n,fn:t}),this},off:function(e,t,n){var s=this,i=s["_on"+e],a=0;if("number"==typeof t&&(n=t,t=null),t||n)for(a=0;a<i.length;a++){var o=n===i[a].id;if(t===i[a].fn&&o||!t&&o){i.splice(a,1);break}}else if(e)s["_on"+e]=[];else{var r=Object.keys(s);for(a=0;a<r.length;a++)0===r[a].indexOf("_on")&&Array.isArray(s[r[a]])&&(s[r[a]]=[])}return s},once:function(e,t,n){return this.on(e,t,n,1),this},_emit:function(e,t,n){for(var s=this,i=s["_on"+e],a=i.length-1;a>=0;a--)i[a].id&&i[a].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,n)}.bind(s,i[a].fn),0),i[a].once&&s.off(e,i[a].fn,i[a].id));return s._loadQueue(e),s},_loadQueue:function(e){var t=this;if(t._queue.length>0){var n=t._queue[0];n.event===e&&(t._queue.shift(),t._loadQueue()),e||n.action()}return t},_ended:function(e){var t=this,n=e._sprite;if(!t._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(t._ended.bind(t,e),100),t;var s=!(!e._loop&&!t._sprite[n][2]);if(t._emit("end",e._id),!t._webAudio&&s&&t.stop(e._id,!0).play(e._id),t._webAudio&&s){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=a.ctx.currentTime;var i=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),i)}return t._webAudio&&!s&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),a._autoSuspend()),t._webAudio||s||t.stop(e._id,!0),t},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!=typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var n=t._soundById(e);n&&n._node&&n._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,n=0;n<t._sounds.length;n++)if(e===t._sounds[n]._id)return t._sounds[n];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new r(e)},_drain:function(){var e=this,t=e._pool,n=0,s=0;if(!(e._sounds.length<t)){for(s=0;s<e._sounds.length;s++)e._sounds[s]._ended&&n++;for(s=e._sounds.length-1;s>=0;s--){if(n<=t)return;e._sounds[s]._ended&&(e._webAudio&&e._sounds[s]._node&&e._sounds[s]._node.disconnect(0),e._sounds.splice(s,1),n--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],n=0;n<this._sounds.length;n++)t.push(this._sounds[n]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=a.ctx.createBufferSource(),e._node.bufferSource.buffer=l[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,a.ctx.currentTime),this},_cleanBuffer:function(e){var t=a._navigator&&a._navigator.vendor.indexOf("Apple")>=0;if(a._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=a._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(a._navigator&&a._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var r=function(e){this._parent=e,this.init()};r.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++a._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,n=a._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node=void 0===a.ctx.createGain?a.ctx.createGainNode():a.ctx.createGain(),e._node.gain.setValueAtTime(n,a.ctx.currentTime),e._node.paused=!0,e._node.connect(a.masterGain)):a.noAudio||(e._node=a._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(a._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=t._src,e._node.preload=!0===t._preload?"auto":t._preload,e._node.volume=n*a.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++a._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),e._node.removeEventListener(a._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var l={},h=function(e){var t=e._src;if(l[t])return e._duration=l[t].duration,void u(e);if(/^data:[^;]+;base64,/.test(t)){for(var n=atob(t.split(",")[1]),s=new Uint8Array(n.length),i=0;i<n.length;++i)s[i]=n.charCodeAt(i);d(s.buffer,e)}else{var a=new XMLHttpRequest;a.open(e._xhr.method,t,!0),a.withCredentials=e._xhr.withCredentials,a.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){a.setRequestHeader(t,e._xhr.headers[t])})),a.onload=function(){var t=(a.status+"")[0];"0"===t||"2"===t||"3"===t?d(a.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+a.status+".")},a.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete l[t],e.load())},c(a)}},c=function(e){try{e.send()}catch(t){e.onerror()}},d=function(e,t){var n=function(){t._emit("loaderror",null,"Decoding audio data failed.")},s=function(e){e&&t._sounds.length>0?(l[t._src]=e,u(t,e)):n()};"undefined"!=typeof Promise&&1===a.ctx.decodeAudioData.length?a.ctx.decodeAudioData(e).then(s).catch(n):a.ctx.decodeAudioData(e,s,n)},u=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},m=function(){if(a.usingWebAudio){try{"undefined"!=typeof AudioContext?a.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?a.ctx=new webkitAudioContext:a.usingWebAudio=!1}catch(e){a.usingWebAudio=!1}a.ctx||(a.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(a._navigator&&a._navigator.platform),t=a._navigator&&a._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n=t?parseInt(t[1],10):null;if(e&&n&&n<9){var s=/safari/.test(a._navigator&&a._navigator.userAgent.toLowerCase());a._navigator&&!s&&(a.usingWebAudio=!1)}a.usingWebAudio&&(a.masterGain=void 0===a.ctx.createGain?a.ctx.createGainNode():a.ctx.createGain(),a.masterGain.gain.setValueAtTime(a._muted?0:a._volume,a.ctx.currentTime),a.masterGain.connect(a.ctx.destination)),a._setup()}};void 0===(s=function(){return{Howler:a,Howl:o}}.apply(t,[]))||(e.exports=s),t.Howler=a,t.Howl=o,void 0!==n.g?(n.g.HowlerGlobal=i,n.g.Howler=a,n.g.Howl=o,n.g.Sound=r):"undefined"!=typeof window&&(window.HowlerGlobal=i,window.Howler=a,window.Howl=o,window.Sound=r)}(),function(){"use strict";var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var n=t._howls.length-1;n>=0;n--)t._howls[n].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,n){var s=this;return s.ctx&&s.ctx.listener?(t="number"!=typeof t?s._pos[1]:t,n="number"!=typeof n?s._pos[2]:n,"number"!=typeof e?s._pos:(s._pos=[e,t,n],void 0!==s.ctx.listener.positionX?(s.ctx.listener.positionX.setTargetAtTime(s._pos[0],Howler.ctx.currentTime,.1),s.ctx.listener.positionY.setTargetAtTime(s._pos[1],Howler.ctx.currentTime,.1),s.ctx.listener.positionZ.setTargetAtTime(s._pos[2],Howler.ctx.currentTime,.1)):s.ctx.listener.setPosition(s._pos[0],s._pos[1],s._pos[2]),s)):s},HowlerGlobal.prototype.orientation=function(e,t,n,s,i,a){var o=this;if(!o.ctx||!o.ctx.listener)return o;var r=o._orientation;return t="number"!=typeof t?r[1]:t,n="number"!=typeof n?r[2]:n,s="number"!=typeof s?r[3]:s,i="number"!=typeof i?r[4]:i,a="number"!=typeof a?r[5]:a,"number"!=typeof e?r:(o._orientation=[e,t,n,s,i,a],void 0!==o.ctx.listener.forwardX?(o.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),o.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),o.ctx.listener.forwardZ.setTargetAtTime(n,Howler.ctx.currentTime,.1),o.ctx.listener.upX.setTargetAtTime(s,Howler.ctx.currentTime,.1),o.ctx.listener.upY.setTargetAtTime(i,Howler.ctx.currentTime,.1),o.ctx.listener.upZ.setTargetAtTime(a,Howler.ctx.currentTime,.1)):o.ctx.listener.setOrientation(e,t,n,s,i,a),o)},Howl.prototype.init=(e=Howl.prototype.init,function(t){var n=this;return n._orientation=t.orientation||[1,0,0],n._stereo=t.stereo||null,n._pos=t.pos||null,n._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},n._onstereo=t.onstereo?[{fn:t.onstereo}]:[],n._onpos=t.onpos?[{fn:t.onpos}]:[],n._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,n){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"stereo",action:function(){s.stereo(e,n)}}),s;var i=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===n){if("number"!=typeof e)return s._stereo;s._stereo=e,s._pos=[e,0,0]}for(var a=s._getSoundIds(n),o=0;o<a.length;o++){var r=s._soundById(a[o]);if(r){if("number"!=typeof e)return r._stereo;r._stereo=e,r._pos=[e,0,0],r._node&&(r._pannerAttr.panningModel="equalpower",r._panner&&r._panner.pan||t(r,i),"spatial"===i?void 0!==r._panner.positionX?(r._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),r._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),r._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):r._panner.setPosition(e,0,0):r._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),s._emit("stereo",r._id)}}return s},Howl.prototype.pos=function(e,n,s,i){var a=this;if(!a._webAudio)return a;if("loaded"!==a._state)return a._queue.push({event:"pos",action:function(){a.pos(e,n,s,i)}}),a;if(n="number"!=typeof n?0:n,s="number"!=typeof s?-.5:s,void 0===i){if("number"!=typeof e)return a._pos;a._pos=[e,n,s]}for(var o=a._getSoundIds(i),r=0;r<o.length;r++){var l=a._soundById(o[r]);if(l){if("number"!=typeof e)return l._pos;l._pos=[e,n,s],l._node&&(l._panner&&!l._panner.pan||t(l,"spatial"),void 0!==l._panner.positionX?(l._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(s,Howler.ctx.currentTime)):l._panner.setPosition(e,n,s)),a._emit("pos",l._id)}}return a},Howl.prototype.orientation=function(e,n,s,i){var a=this;if(!a._webAudio)return a;if("loaded"!==a._state)return a._queue.push({event:"orientation",action:function(){a.orientation(e,n,s,i)}}),a;if(n="number"!=typeof n?a._orientation[1]:n,s="number"!=typeof s?a._orientation[2]:s,void 0===i){if("number"!=typeof e)return a._orientation;a._orientation=[e,n,s]}for(var o=a._getSoundIds(i),r=0;r<o.length;r++){var l=a._soundById(o[r]);if(l){if("number"!=typeof e)return l._orientation;l._orientation=[e,n,s],l._node&&(l._panner||(l._pos||(l._pos=a._pos||[0,0,-.5]),t(l,"spatial")),void 0!==l._panner.orientationX?(l._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),l._panner.orientationZ.setValueAtTime(s,Howler.ctx.currentTime)):l._panner.setOrientation(e,n,s)),a._emit("orientation",l._id)}}return a},Howl.prototype.pannerAttr=function(){var e,n,s,i=this,a=arguments;if(!i._webAudio)return i;if(0===a.length)return i._pannerAttr;if(1===a.length){if("object"!=typeof a[0])return(s=i._soundById(parseInt(a[0],10)))?s._pannerAttr:i._pannerAttr;e=a[0],void 0===n&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),i._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:i._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:i._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:i._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:i._panningModel})}else 2===a.length&&(e=a[0],n=parseInt(a[1],10));for(var o=i._getSoundIds(n),r=0;r<o.length;r++)if(s=i._soundById(o[r])){var l=s._pannerAttr;l={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:l.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:l.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:l.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:l.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:l.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:l.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:l.panningModel};var h=s._panner;h?(h.coneInnerAngle=l.coneInnerAngle,h.coneOuterAngle=l.coneOuterAngle,h.coneOuterGain=l.coneOuterGain,h.distanceModel=l.distanceModel,h.maxDistance=l.maxDistance,h.refDistance=l.refDistance,h.rolloffFactor=l.rolloffFactor,h.panningModel=l.panningModel):(s._pos||(s._pos=i._pos||[0,0,-.5]),t(s,"spatial"))}return i},Sound.prototype.init=function(e){return function(){var t=this,n=t._parent;t._orientation=n._orientation,t._stereo=n._stereo,t._pos=n._pos,t._pannerAttr=n._pannerAttr,e.call(this),t._stereo?n.stereo(t._stereo):t._pos&&n.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,n=t._parent;return t._orientation=n._orientation,t._stereo=n._stereo,t._pos=n._pos,t._pannerAttr=n._pannerAttr,t._stereo?n.stereo(t._stereo):t._pos?n.pos(t._pos[0],t._pos[1],t._pos[2],t._id):t._panner&&(t._panner.disconnect(0),t._panner=void 0,n._refreshBuffer(t)),e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}()}},t={};function n(s){var i=t[s];if(void 0!==i)return i.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,n),a.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{"use strict";var e,t,s,i;!function(e){e[e.Empty=0]="Empty",e[e.Hand=1]="Hand",e[e.Pistol=2]="Pistol",e[e.Machinegun=3]="Machinegun",e[e.Shotgun=4]="Shotgun",e[e.Rifle=5]="Rifle",e[e.Hammer=6]="Hammer",e[e.Granade=7]="Granade",e[e.Smoke=8]="Smoke",e[e.Medkit=9]="Medkit"}(e||(e={})),function(e){e[e.Grass=0]="Grass",e[e.Water=1]="Water",e[e.WaterTriangle1=2]="WaterTriangle1",e[e.WaterTriangle2=3]="WaterTriangle2",e[e.WaterTriangle3=4]="WaterTriangle3",e[e.WaterTriangle4=5]="WaterTriangle4"}(t||(t={}));class a{constructor(e,n,s,i){switch(this.angle=0,this.type=e,this.x=n,this.y=s,this.size=i,e){case t.WaterTriangle2:this.angle=90;break;case t.WaterTriangle3:this.angle=180;break;case t.WaterTriangle4:this.angle=270}}}class o{constructor(e,t,n,s){this.changed=!1,this.opacity=1,this.active=!0,this.id=e,this.x=t,this.y=n,this.size=s,this.radius=s/2}getChanged(){return this.changed}nullChanged(){this.changed=!1}update(e){this.opacity=e}isPointIn(e){const t=this.x+this.radius-e.x,n=this.y+this.radius-e.y;return Math.sqrt(t*t+n*n)<=this.radius}getCenterX(){return this.x+this.size/2}getCenterY(){return this.y+this.size/2}getOpacity(){return this.opacity}isActive(){return this.active}increaseOpacity(e){this.opacity+=.01*e,this.opacity>1&&(this.opacity=1)}decreaseOpacity(e){this.opacity-=.01*e,this.opacity<.5&&(this.opacity=.5)}}class r extends o{constructor(e,t,n,s){super(e,t,n,500),this.treeTrankRadius=35,this.angle=s}}class l extends o{constructor(e,t,n){super(e,t,n,100),this.opacity=1}}class h extends o{constructor(e,t,n,s){super(e,t,n,350),this.angle=s}}class c{constructor(e,t,n,s,i){this.changed=!1,this.opacity=1,this.active=!0,this.id=e,this.x=t,this.y=n,this.width=s,this.height=i}getChanged(){return this.changed}nullChanged(){this.changed=!1}getChangedData(){return{id:this.id,opacity:this.opacity}}update(e){this.opacity=e}isPointIn(e){const{x:t,y:n}=e;return t<this.x+this.width&&t>=this.x&&n>=this.y&&n<this.y+this.height}getOpacity(){return this.opacity}isActive(){return this.active}acceptHit(){this.active&&(this.opacity>.1&&(this.opacity-=.1),this.opacity<.1&&(this.active=!1),this.changed=!0)}}class d extends c{constructor(e,t,n,s,i){super(e,t,n,s,i)}}class u{constructor(){this.water="#69A2E0",this.grass="#A2CB69",this.blockFrame="gray",this.blockFrameActive="red",this.bullet="red",this.text="white",this.collisionPoint="red",this.player="#FFC878",this.hand="#FFC878",this.handBorder="#424242",this.vest="#424242",this.waterCircle="#2871C1"}}class m{constructor(e,t,n,s,i){this.age=0,this.maxAge=10,this.startX=e,this.startY=t,this.endX=n,this.endY=s,this.bulletLine=i}increaseAge(){this.age++}isActive(){return this.age<=this.maxAge}getAge(){return this.age}}class p{constructor(e,t,n){this.parts=[],this.id=e,this.startX=t,this.startY=n}setEnd(e,t){let n=this.startX,s=this.startY;this.parts.length&&(n=this.parts[this.parts.length-1].endX,s=this.parts[this.parts.length-1].endY),this.parts.push(new m(n,s,e,t,this))}isActive(){return!this.parts.length||this.parts[this.parts.length-1].isActive()}}class g{constructor(e,t){this.x=e,this.y=t}}!function(e){e[e.Pistol=0]="Pistol",e[e.Machinegun=1]="Machinegun",e[e.Shotgun=2]="Shotgun",e[e.Rifle=3]="Rifle",e[e.Hammer=4]="Hammer",e[e.RedAmmo=5]="RedAmmo",e[e.GreenAmmo=6]="GreenAmmo",e[e.BlueAmmo=7]="BlueAmmo",e[e.OrangeAmmo=8]="OrangeAmmo",e[e.Vest=9]="Vest",e[e.Medkit=10]="Medkit",e[e.Granade=11]="Granade",e[e.Smoke=12]="Smoke",e[e.Scope2=13]="Scope2",e[e.Scope4=14]="Scope4",e[e.Scope6=15]="Scope6"}(s||(s={}));class y{constructor(){this.loadingMax=40,this.loading=this.loadingMax,this.scope=.3,this.scopeLoadingChange=0,this.scopeResolutionAdjustment=.3}setScope(e){switch(e){case 2:e=1.2;break;case 4:e=1.4;break;case 6:e=1.6}const t=this.scope;this.scope=e,e!==t&&(this.scopeLoadingChange=(e-t)/this.loadingMax,this.loading=0)}getFinalResolutionAdjustment(e){return this.loading!==this.loadingMax&&(this.scopeResolutionAdjustment+=this.scopeLoadingChange,this.loading++),e/this.scopeResolutionAdjustment}}class f{constructor(e,t,n,s,i,a){this.resolutionAdjustment=1,this.finalResolutionAdjustment=1,this.bulletLines=[],this.lastdrawTime=Date.now(),this.scope=new y,this.snapshotManager=a,this.colors=new u,this.myHtmlElements=s,this.map=e,this.collisionPoints=i,this.mouse=t,this.gameScreen=this.myHtmlElements.gameScreen,this.editorScreen=this.myHtmlElements.editor.screen,this.mapScreen=this.myHtmlElements.mapScreen,this.helperScreen=this.myHtmlElements.helperScreen,this.ctxGame=this.gameScreen.getContext("2d"),this.ctxMap=this.mapScreen.getContext("2d"),this.ctxEditor=this.editorScreen.getContext("2d"),this.horizontalWallSVG=new Image,this.horizontalWallSVG.src="img/horizontalWall.svg",this.verticalWallSVG=new Image,this.verticalWallSVG.src="img/verticalWall.svg",this.bushSVG=new Image,this.bushSVG.src="img/bush.svg",this.rockSVG=new Image,this.rockSVG.src="img/rock.svg",this.treeSVG=new Image,this.treeSVG.src="img/tree.svg",this.cursorSVG=new Image,this.cursorSVG.src="img/cursor.svg",this.loadingProgresSVG=new Image,this.loadingProgresSVG.src="img/loadingProgres.svg",this.loadingCircleSVG=new Image,this.loadingCircleSVG.src="img/loadingCircle.svg",this.pistolSVG=new Image,this.pistolSVG.src="img/pistol.svg",this.machinegunSVG=new Image,this.machinegunSVG.src="img/machinegun.svg",this.rifleSVG=new Image,this.rifleSVG.src="img/rifle.svg",this.shotgunSVG=new Image,this.shotgunSVG.src="img/shotgun.svg",this.hammerSVG=new Image,this.hammerSVG.src="img/hammer.svg",this.granadeSVG=new Image,this.granadeSVG.src="img/granade.svg",this.smokeSVG=new Image,this.smokeSVG.src="img/smoke.svg",this.medkitSVG=new Image,this.medkitSVG.src="img/medkit.svg",this.smokeCloudSVG=new Image,this.smokeCloudSVG.src="img/smokeCloud.svg",this.rifleLootSVG=new Image,this.rifleLootSVG.src="img/rifleLoot.svg",this.pistolLootSVG=new Image,this.pistolLootSVG.src="img/pistolLoot.svg",this.shotgunLootSVG=new Image,this.shotgunLootSVG.src="img/shotgunLoot.svg",this.machinegunLootSVG=new Image,this.machinegunLootSVG.src="img/machinegunLoot.svg",this.hammerLootSVG=new Image,this.hammerLootSVG.src="img/hammerLoot.svg",this.granadeLootSVG=new Image,this.granadeLootSVG.src="img/granadeLoot.svg",this.smokeLootSVG=new Image,this.smokeLootSVG.src="img/smokeLoot.svg",this.redAmmoLootSVG=new Image,this.redAmmoLootSVG.src="img/redAmmoLoot.svg",this.greenAmmoLootSVG=new Image,this.greenAmmoLootSVG.src="img/greenAmmoLoot.svg",this.blueAmmoLootSVG=new Image,this.blueAmmoLootSVG.src="img/blueAmmoLoot.svg",this.orangeAmmoLootSVG=new Image,this.orangeAmmoLootSVG.src="img/orangeAmmoLoot.svg",this.medkitLootSVG=new Image,this.medkitLootSVG.src="img/medkitLoot.svg",this.vestLootSVG=new Image,this.vestLootSVG.src="img/vestLoot.svg",this.scope2LootSVG=new Image,this.scope2LootSVG.src="img/scope2Loot.svg",this.scope4LootSVG=new Image,this.scope4LootSVG.src="img/scope4Loot.svg",this.scope6LootSVG=new Image,this.scope6LootSVG.src="img/scope6Loot.svg",this.deadPlayer=new Image,this.deadPlayer.src="img/deadPlayer.svg",this.waterTrianglePNG=new Image,this.waterTrianglePNG.src="img/waterTriangle.png",this.waterTerrainData=n,this.screenResize()}reset(){this.myPlayer=null,this.scope=new y,this.bulletLines=[]}screenResize(){const e=this.myHtmlElements;this.gameScreen.width=window.innerWidth,this.gameScreen.height=window.innerHeight,e.zoneSVG.setAttribute("width",window.innerWidth.toString()),e.zoneSVG.setAttribute("height",window.innerHeight.toString());const t=Math.floor((window.innerWidth/5+window.innerHeight/5)/2);this.mapScreen.width=t,this.mapScreen.height=t,e.mapZoneSVG.setAttribute("width",t.toString()),e.mapZoneSVG.setAttribute("height",t.toString()),e.mapContainer.style.width=(t+10).toString()+"px",e.mapContainer.style.height=(t+10).toString()+"px",this.screenCenterX=window.innerWidth/2,this.screenCenterY=window.innerHeight/2,this.changeResolutionAdjustment(),this.myPlayer&&this.drawGame(this.myPlayer.id)}calculateServerPosition(e){let t,n;return t=this.screenCenterX>e.x?-1*(this.screenCenterX-e.x):e.x-this.screenCenterX,n=this.screenCenterY>e.y?-1*(this.screenCenterY-e.y):e.y-this.screenCenterY,t/=this.finalResolutionAdjustment,n/=this.finalResolutionAdjustment,t+=this.myPlayer.getCenterX(),n+=this.myPlayer.getCenterY(),new g(t,n)}changeResolutionAdjustment(){const e=(this.gameScreen.width/1920+this.gameScreen.height/1050)/2;this.resolutionAdjustment=e}saveWaterPixels(e){const n=this.helperScreen.getContext("2d");this.helperScreen.width=this.waterTrianglePNG.width,this.helperScreen.height=this.waterTrianglePNG.height,n.fillStyle="#FFFFFF",n.fillRect(0,0,this.helperScreen.width,this.helperScreen.height);let s=this.waterTrianglePNG.width/2;switch(n.save(),n.translate(s,s),e){case t.WaterTriangle1:n.rotate(0*Math.PI/180);break;case t.WaterTriangle2:n.rotate(90*Math.PI/180);break;case t.WaterTriangle3:n.rotate(180*Math.PI/180);break;case t.WaterTriangle4:n.rotate(270*Math.PI/180)}if(n.drawImage(this.waterTrianglePNG,-s,-s),n.restore(),"undefined"!=typeof Worker){const t=new Worker("js/workerFindWater.js");t.onmessage=e=>{this.waterTerrainData.setData(e.data.type,e.data.data)};const s=n.getImageData(0,0,this.waterTrianglePNG.width,this.waterTrianglePNG.height).data;t.postMessage({data:s,size:this.waterTrianglePNG.width,type:e,time:(new Date).getTime()})}else console.log("err: Your browser doesn't support web workers.")}drawMap(){const e=this.ctxMap,n=this.myHtmlElements;e.clearRect(0,0,this.mapScreen.width,this.mapScreen.height),e.fillStyle=this.colors.grass,e.fillRect(0,0,this.mapScreen.width,this.mapScreen.height);const s=this.mapScreen.width/(this.map.getSize()/this.map.getBlockSize()),i=s/this.map.getBlockSize(),a=s+s/50;for(const n of this.map.terrain){const o=n.x*i,r=n.y*i;if(n.type===t.Water&&(e.fillStyle=this.colors.water,e.fillRect(o,r,a,a)),n.type!==t.Water){const t=a/2;e.save(),e.translate(o+t,r+t),e.rotate(n.angle*Math.PI/180),e.drawImage(this.waterTrianglePNG,-t,-t,s,s),e.restore()}}{const t=this.mapScreen.width/30,n=this.myPlayer.getCenterX()*i,s=this.myPlayer.getCenterY()*i;e.beginPath(),e.arc(n,s,t/2,0,2*Math.PI),e.fillStyle="red",e.fill()}{const t=this.snapshotManager.zone.innerCircle.getCenterX()*i,n=this.snapshotManager.zone.innerCircle.getCenterY()*i,s=this.snapshotManager.zone.innerCircle.getRadius()*i;e.beginPath(),e.arc(t,n,s,0,2*Math.PI),e.strokeStyle="green",e.stroke()}{const e=this.snapshotManager.zone.outerCircle.getCenterX()*i,t=this.snapshotManager.zone.outerCircle.getCenterY()*i,s=this.snapshotManager.zone.outerCircle.getRadius()*i;n.mapZoneCircle.setAttribute("r",s.toString()),n.mapZoneCircle.setAttribute("cx",e.toString()),n.mapZoneCircle.setAttribute("cy",t.toString())}}drawEditor(e){const n=this.ctxEditor;n.clearRect(0,0,this.editorScreen.width,this.editorScreen.height),n.fillStyle=this.colors.grass,n.fillRect(0,0,this.editorScreen.width,this.editorScreen.height),n.fillStyle=this.colors.water;for(const s of e.terrains)switch(s.type){case t.Water:n.fillRect(s.x,s.y,e.blockSize,e.blockSize);break;case t.WaterTriangle1:n.drawImage(this.waterTrianglePNG,s.x,s.y,e.blockSize,e.blockSize);break;case t.WaterTriangle2:case t.WaterTriangle3:case t.WaterTriangle4:let i=e.blockSize/2;n.save(),n.translate(s.x+i,s.y+i),n.rotate(s.angle*Math.PI/180),n.drawImage(this.waterTrianglePNG,-i,-i,e.blockSize,e.blockSize),n.restore()}let s,i;if(null!=e.getTerrainType()){s=Math.floor(e.getX()/e.blockSize)*e.blockSize,i=Math.floor(e.getY()/e.blockSize)*e.blockSize;let a=-1;switch(e.getTerrainType()){case t.Water:n.fillStyle=this.colors.water,n.fillRect(s,i,e.blockSize,e.blockSize);break;case t.Grass:n.fillStyle=this.colors.grass,n.fillRect(s,i,e.blockSize,e.blockSize);break;case t.WaterTriangle1:a=0;break;case t.WaterTriangle2:a=90;break;case t.WaterTriangle3:a=180;break;case t.WaterTriangle4:a=270}if(-1!==a){n.fillStyle=this.colors.grass,n.fillRect(s,i,e.blockSize,e.blockSize);let t=e.blockSize/2;n.save(),n.translate(s+t,i+t),n.rotate(a*Math.PI/180),n.drawImage(this.waterTrianglePNG,-t,-t,e.blockSize,e.blockSize),n.restore()}}n.fillStyle=this.colors.blockFrame;for(let t=0;t<e.getSize();t++)n.fillRect(t*e.blockSize,0,1,e.getSize()*e.blockSize);for(let t=0;t<e.getSize();t++)n.fillRect(0,t*e.blockSize,e.getSize()*e.blockSize,1);null!=e.getTerrainType()&&(n.fillStyle=this.colors.blockFrameActive,n.fillRect(s,i,e.blockSize,1),n.fillRect(s,i+e.blockSize,e.blockSize,1),n.fillRect(s,i,1,e.blockSize),n.fillRect(s+e.blockSize,i,1,e.blockSize)),n.save(),"delete"===e.getObjectType()&&(n.globalAlpha=.6);for(const t of e.rocks)n.drawImage(this.rockSVG,t.x,t.y,t.size,t.size);for(const t of e.walls){let e=this.horizontalWallSVG;t.width<t.height&&(e=this.verticalWallSVG),(t.width<t.height||t.width>t.height)&&n.drawImage(e,t.x,t.y,t.width,t.height),t.width===t.height&&(n.fillStyle="black",n.fillRect(t.x,t.y,t.width,t.height))}for(const t of e.bushes)n.drawImage(this.bushSVG,t.x,t.y,t.size,t.size);for(const t of e.trees)n.drawImage(this.treeSVG,t.x,t.y,t.size,t.size);if(n.restore(),"delete"===e.getObjectType()){let t;for(const n of e.rocks){const s=n;s.x<=e.getX()&&s.x+s.size>=e.getX()&&s.y<=e.getY()&&s.y+s.size>=e.getY()&&(t=s)}for(const n of e.walls){const s=n;s.x<=e.getX()&&s.x+s.width>=e.getX()&&s.y<=e.getY()&&s.y+s.height>=e.getY()&&(t=s)}for(const n of e.bushes){const s=n;s.x<=e.getX()&&s.x+s.size>=e.getX()&&s.y<=e.getY()&&s.y+s.size>=e.getY()&&(t=s)}for(const n of e.trees){const s=n;s.x<=e.getX()&&s.x+s.size>=e.getX()&&s.y<=e.getY()&&s.y+s.size>=e.getY()&&(t=s)}if(t instanceof l&&n.drawImage(this.rockSVG,t.x,t.y,t.size,t.size),t instanceof h&&n.drawImage(this.bushSVG,t.x,t.y,t.size,t.size),t instanceof r&&n.drawImage(this.treeSVG,t.x,t.y,t.size,t.size),t instanceof d){n.fillRect(t.x,t.y,t.width,t.height);let e=this.verticalWallSVG;t.width>t.height&&(e=this.horizontalWallSVG),n.drawImage(e,t.x,t.y,t.width,t.height)}}if(e.getObjectType()){let t;switch(e.getObjectType()){case"bush":t=e.bush.size,n.drawImage(this.bushSVG,e.getX()-t/2,e.getY()-t/2,t,t);break;case"rock":t=e.rock.size,n.drawImage(this.rockSVG,e.getX()-t/2,e.getY()-t/2,t,t);break;case"tree":t=e.tree.size,n.drawImage(this.treeSVG,e.getX()-t/2,e.getY()-t/2,t,t);break;case"rect":t=e.rock.size,n.fillStyle="black",n.fillRect(e.getX()-t/2,e.getY()-t/2,t,t);break;case"verticalWall":n.drawImage(this.verticalWallSVG,e.getX()-e.verticalWall.width/2,e.getY()-e.verticalWall.height/2,e.verticalWall.width,e.verticalWall.height);break;case"horizontalWall":n.drawImage(this.horizontalWallSVG,e.getX()-e.horizontalWall.width/2,e.getY()-e.horizontalWall.height/2,e.horizontalWall.width,e.horizontalWall.height)}}}frameRateAdjuster(){const e=Date.now(),t=e-this.lastdrawTime;return this.lastdrawTime=e,t/16.66666}isPlayerUnderRoundObject(e,t){const n=e.getCenterX()-t.getCenterX(),s=e.getCenterY()-t.getCenterY();return Math.sqrt(n*n+s*s)<e.radius+t.radius}drawGame(n){const i=this.snapshotManager.betweenSnapshot,a=this.snapshotManager.players;if(!i)return;if(-1!==i.i.spectate&&(n=i.i.spectate),this.myPlayer=this.snapshotManager.getMyPlayer(n),!this.myPlayer)return;this.scope.setScope(this.snapshotManager.betweenSnapshot.i.s),this.finalResolutionAdjustment=this.scope.getFinalResolutionAdjustment(this.resolutionAdjustment),this.drawMap();const o=this.ctxGame,r=this.myHtmlElements;o.clearRect(0,0,this.gameScreen.width,this.gameScreen.height),o.fillStyle=this.colors.water,o.fillRect(0,0,this.gameScreen.width,this.gameScreen.height),o.fillStyle=this.colors.grass;const l=300;for(const e of this.map.blocks){const{x:t,y:n,size:s,isOnScreen:i}=this.howToDraw({x:e.x,y:e.y,size:l});i&&o.fillRect(t,n,s,s)}o.fillStyle=this.colors.water;for(const e of this.map.terrain){const{x:n,y:s,width:i,height:a,isOnScreen:r}=this.howToDraw({x:e.x,y:e.y,size:e.size});if(r)if(e.type===t.Water)o.fillRect(n,s,i,a);else if(e.type===t.WaterTriangle1)o.drawImage(this.waterTrianglePNG,n,s,i,a);else if(e.type===t.WaterTriangle2||e.type===t.WaterTriangle3||e.type===t.WaterTriangle4){let t=i/2;o.save(),o.translate(n+t,s+t),o.rotate(e.angle*Math.PI/180),o.drawImage(this.waterTrianglePNG,-t,-t,i,a),o.restore()}}o.fillStyle=this.colors.waterCircle;const h=this.frameRateAdjuster();for(const e of this.snapshotManager.waterCircles){if(!e.isActive())continue;e.flow(h);const{x:t,y:n,size:s,isOnScreen:i}=this.howToDraw({x:e.getX(),y:e.getY(),size:e.getSize()});if(i){const i=s/2;o.save(),o.globalAlpha=e.getOpacity(),o.beginPath(),o.arc(t+i,n+i,i,0,2*Math.PI),o.fill(),o.restore()}}o.fillStyle=this.colors.blockFrame;const c=1*this.resolutionAdjustment;for(const e of this.map.blocks){if(0===e.y){const{x:t,y:n,size:s,isOnScreen:i}=this.howToDraw({x:e.x,y:e.y,size:l});i&&o.fillRect(t,n,s,c)}{const{x:t,y:n,size:s,isOnScreen:i}=this.howToDraw({x:e.x,y:e.y+l,size:l});i&&o.fillRect(t,n,s,c)}if(0===e.x){const{x:t,y:n,size:s,isOnScreen:i}=this.howToDraw({x:e.x,y:e.y,size:l});i&&o.fillRect(t,n,c,s)}{const{x:t,y:n,size:s,isOnScreen:i}=this.howToDraw({x:e.x+l,y:e.y,size:l});i&&o.fillRect(t,n,c,s)}}for(const e of this.map.rocks)if(e.isActive()){const{x:t,y:n,size:s,isOnScreen:i}=this.howToDraw(e);i&&(o.save(),o.globalAlpha=e.getOpacity(),o.drawImage(this.rockSVG,t,n,s,s),o.restore())}o.fillStyle="black";for(const e of this.map.rectangleObstacles)if(e.isActive()){const{x:t,y:n,width:s,height:i,isOnScreen:a}=this.howToDraw({x:e.x,y:e.y,width:e.width,height:e.height});if(a){let a=this.horizontalWallSVG;e.width<e.height&&(a=this.verticalWallSVG),o.save(),o.globalAlpha=e.getOpacity(),o.drawImage(a,t,n,s,i),o.restore()}}for(const e of a){if(e.alive())continue;const{x:t,y:n,width:s,height:i,isOnScreen:a}=this.howToDraw({x:e.getX(),y:e.getY(),size:e.size});a&&o.drawImage(this.deadPlayer,t,n,s,i)}for(const e of i.l){const{x:t,y:n,size:i,isOnScreen:a}=this.howToDraw(e);let r;switch(e.type){case s.Pistol:r=this.pistolLootSVG;break;case s.Machinegun:r=this.machinegunLootSVG;break;case s.Shotgun:r=this.shotgunLootSVG;break;case s.Rifle:r=this.rifleLootSVG;break;case s.Smoke:r=this.smokeLootSVG;break;case s.Granade:r=this.granadeLootSVG;break;case s.Hammer:r=this.hammerLootSVG;break;case s.RedAmmo:r=this.redAmmoLootSVG;break;case s.BlueAmmo:r=this.blueAmmoLootSVG;break;case s.GreenAmmo:r=this.greenAmmoLootSVG;break;case s.OrangeAmmo:r=this.orangeAmmoLootSVG;break;case s.Vest:r=this.vestLootSVG;break;case s.Medkit:r=this.medkitLootSVG;break;case s.Scope2:r=this.scope2LootSVG;break;case s.Scope4:r=this.scope4LootSVG;break;case s.Scope6:r=this.scope6LootSVG}o.drawImage(r,t,n,i,i)}for(const t of a){if(!t.alive())continue;const{x:n,y:s,size:i,isOnScreen:a}=this.howToDraw({x:t.getX(),y:t.getY(),size:t.size});if(a){const e=i/2;o.beginPath(),o.arc(n+e,s+e,e,0,2*Math.PI);let a=this.colors.player;t.getVest()&&(a=this.colors.vest),o.fillStyle=a,o.fill();let r=.92*e;o.beginPath(),o.arc(n+e,s+e,r,0,2*Math.PI),o.fillStyle=this.colors.player,o.fill()}const r=280;if(t.getWeapon()===e.Pistol){const e=t.getCenterX()-r/2,n=t.getCenterY()-r/2,{x:s,y:i,size:a,isOnScreen:l}=this.howToDraw({x:e,y:n,size:r});if(l){let e=a/2;o.save(),o.translate(s+e,i+e),o.rotate(t.getAngle()*Math.PI/180),o.drawImage(this.pistolSVG,-e,-e,a,a),o.restore()}}if(t.getWeapon()===e.Machinegun){const e=t.getCenterX()-r/2,n=t.getCenterY()-r/2,{x:s,y:i,size:a,isOnScreen:l}=this.howToDraw({x:e,y:n,size:r});if(l){let e=a/2;o.save(),o.translate(s+e,i+e),o.rotate(t.getAngle()*Math.PI/180),o.drawImage(this.machinegunSVG,-e,-e,a,a),o.restore()}}if(t.getWeapon()===e.Shotgun){const e=t.getCenterX()-r/2,n=t.getCenterY()-r/2,{x:s,y:i,size:a,isOnScreen:l}=this.howToDraw({x:e,y:n,size:r});if(l){let e=a/2;o.save(),o.translate(s+e,i+e),o.rotate(t.getAngle()*Math.PI/180),o.drawImage(this.shotgunSVG,-e,-e,a,a),o.restore()}}if(t.getWeapon()===e.Rifle){const e=t.getCenterX()-r/2,n=t.getCenterY()-r/2,{x:s,y:i,size:a,isOnScreen:l}=this.howToDraw({x:e,y:n,size:r});if(l){let e=a/2;o.save(),o.translate(s+e,i+e),o.rotate(t.getAngle()*Math.PI/180),o.drawImage(this.rifleSVG,-e,-e,a,a),o.restore()}}if(t.getWeapon()===e.Hammer){const e=t.getCenterX()-r/2,n=t.getCenterY()-r/2,{x:s,y:i,size:a,isOnScreen:l}=this.howToDraw({x:e,y:n,size:r});if(l){let e=a/2;o.save(),o.translate(s+e,i+e),o.rotate(t.getHammerAngle()*Math.PI/180),o.drawImage(this.hammerSVG,-e,-e,a,a),o.restore()}}if(t.getWeapon()===e.Hand||t.getWeapon()===e.Granade||t.getWeapon()===e.Smoke||t.getWeapon()===e.Medkit)for(let n=0;n<2;n++){const{x:s,y:i,size:a,isOnScreen:r}=this.howToDraw({x:t.hands[n].getX(),y:t.hands[n].getY(),size:t.hands[n].size});if(r){const r=a/2;o.beginPath(),o.arc(s+r,i+r,r,0,2*Math.PI),o.fillStyle=this.colors.handBorder,o.fill();const l=.8*r;if(o.beginPath(),o.arc(s+r,i+r,l,0,2*Math.PI),o.fillStyle=this.colors.hand,o.fill(),(t.getWeapon()===e.Granade||t.getWeapon()===e.Smoke||t.getWeapon()===e.Medkit)&&1===n){const s=t.getAngle(),i=1.2,a=t.hands[n].radius*i,r=Math.sin(s*Math.PI/180)*a,l=Math.cos(s*Math.PI/180)*a,{x:h,y:c,size:d,isOnScreen:u}=this.howToDraw({x:t.hands[n].getCenterX()+r-t.hands[n].radius*i,y:t.hands[n].getCenterY()-l-t.hands[n].radius*i,size:t.hands[n].size*i});if(u){const n=30;let i,a=d/2;o.save(),o.translate(h+a,c+a),o.rotate((s-n)*Math.PI/180),t.getWeapon()===e.Granade&&(i=this.granadeSVG),t.getWeapon()===e.Smoke&&(i=this.smokeSVG),t.getWeapon()===e.Medkit&&(i=this.medkitSVG),o.drawImage(i,-a,-a,d,d),o.restore()}}}}t.getWeapon()===e.Pistol&&(this.drawHandOnWeapon(t,27,0),this.drawHandOnWeapon(t,60,12)),t.getWeapon()===e.Machinegun&&(this.drawHandOnWeapon(t,27,0),this.drawHandOnWeapon(t,75,10)),t.getWeapon()===e.Shotgun&&(this.drawHandOnWeapon(t,27,0),this.drawHandOnWeapon(t,75,10)),t.getWeapon()===e.Rifle&&(this.drawHandOnWeapon(t,27,0),this.drawHandOnWeapon(t,80,9)),t.getWeapon()===e.Hammer&&(this.drawHandOnWeapon(t,40,30),this.drawHandOnWeapon(t,40,-30))}for(const e of this.snapshotManager.players){o.fillStyle=this.colors.collisionPoint;for(let t=e.bloods.length-1;t>=0;t--){const n=e.bloods[t];if(n.getTimer()<n.timerMax){n.shift();const t=e.getCenterX()+n.getX(),s=e.getCenterY()+n.getY(),{x:i,y:a,size:r,isOnScreen:l}=this.howToDraw({x:t,y:s,size:n.size});if(l){const e=1-n.getTimer()/n.timerMax;o.save(),o.globalAlpha=e,o.fillRect(i,a,r,r),o.restore()}}else e.bloods.splice(t,1)}}for(const e of i.g){const t=40*e.b,{x:n,y:s,size:i,isOnScreen:a}=this.howToDraw({x:e.x-t/2,y:e.y-t/2,size:t});if(a){let t=i/2;o.save(),o.translate(n+t,s+t),o.rotate(e.a*Math.PI/180),"g"===e.t&&o.drawImage(this.granadeSVG,-t,-t,i,i),"s"===e.t&&o.drawImage(this.smokeSVG,-t,-t,i,i),o.restore()}}this.createBulletLines();for(const e of this.bulletLines){let t=0;for(const n of e.parts){t++;let e=.05*t+.1;if(e>.8&&(e=.8),n.isActive()){let t=e-n.getAge()/14.3;t<0&&(t=0);const{x:s,y:i}=this.howToDraw({x:n.startX,y:n.startY,size:1}),{x:a,y:r}=this.howToDraw({x:n.endX,y:n.endY,size:1});o.save(),o.globalAlpha=t,o.beginPath(),o.moveTo(s,i),o.lineTo(a,r),o.lineWidth=(6-n.getAge()/3.33)*this.finalResolutionAdjustment,o.strokeStyle="white",o.stroke(),o.restore(),n.increaseAge()}}}for(const e of this.map.bushes)if(e.isActive()){const{x:t,y:n,size:s,isOnScreen:i}=this.howToDraw(e);if(i){this.isPlayerUnderRoundObject(this.myPlayer,e)?e.decreaseOpacity(h):e.increaseOpacity(h);let i=s/2;o.save(),o.translate(t+i,n+i),o.rotate(e.angle*Math.PI/180),o.globalAlpha=e.getOpacity(),o.drawImage(this.bushSVG,-i,-i,s,s),o.restore()}}for(const e of this.map.trees)if(e.isActive()){const{x:t,y:n,size:s,isOnScreen:i}=this.howToDraw(e);if(i){this.isPlayerUnderRoundObject(this.myPlayer,e)?e.decreaseOpacity(h):e.increaseOpacity(h);let i=s/2;o.save(),o.translate(t+i,n+i),o.rotate(e.angle*Math.PI/180),o.globalAlpha=e.getOpacity(),o.drawImage(this.treeSVG,-i,-i,s,s),o.restore()}}for(const e of i.s){const{x:t,y:n,size:s,isOnScreen:i}=this.howToDraw({x:e.x-e.s/2,y:e.y-e.s/2,size:e.s});i&&(o.save(),o.globalAlpha=e.o,o.drawImage(this.smokeCloudSVG,t,n,s,s),o.restore())}const{x:d,y:u,size:m}=this.howToDraw({x:this.snapshotManager.zone.outerCircle.getCenterX(),y:this.snapshotManager.zone.outerCircle.getCenterY(),size:this.snapshotManager.zone.outerCircle.getRadius()});r.zoneCircle.setAttribute("r",m.toString()),r.zoneCircle.setAttribute("cx",d.toString()),r.zoneCircle.setAttribute("cy",u.toString()),r.healthBar.in.style.width=i.i.h+"%";const p=Math.round(i.i.l/i.i.lE*100),g=Math.round((i.i.lE-i.i.l)/1e3*10)/10;if(g&&this.myPlayer.alive()){r.takeLoot.style.display="none",r.loading.main.style.visibility="visible",r.loading.text.style.display="block",r.loading.text.textContent=i.i.lT;let e=g.toString();switch(e){case"0":e=" 0.0";break;case"1":e=" 1.0";break;case"2":e=" 2.0";break;case"3":e=" 3.0";break;case"4":e=" 4.0";break;case"5":e=" 5.0"}r.loading.counter.textContent=e,r.loading.circle.setAttribute("stroke-dasharray",p+", 100")}else r.loading.main.style.visibility="hidden",r.loading.text.style.display="none",r.takeLoot.style.display="block",this.takeLootInfo();r.items.redAmmo.textContent=this.snapshotManager.betweenSnapshot.i.r.toString(),r.items.greenAmmo.textContent=this.snapshotManager.betweenSnapshot.i.g.toString(),r.items.blueAmmo.textContent=this.snapshotManager.betweenSnapshot.i.b.toString(),r.items.orangeAmmo.textContent=this.snapshotManager.betweenSnapshot.i.o.toString(),r.items.item1in.textContent=this.itemName(this.snapshotManager.betweenSnapshot.i.i1),r.items.item2in.textContent=this.itemName(this.snapshotManager.betweenSnapshot.i.i2),this.itemAmmoColor(1,this.snapshotManager.betweenSnapshot.i.i1),this.itemAmmoColor(2,this.snapshotManager.betweenSnapshot.i.i2),r.items.item3in.textContent=this.itemName(this.snapshotManager.betweenSnapshot.i.i3);let y=this.itemName(this.snapshotManager.betweenSnapshot.i.i4);const f=this.snapshotManager.betweenSnapshot.i.s4;y&&(y+=" "+f),r.items.item4in.textContent=y;let _=this.itemName(this.snapshotManager.betweenSnapshot.i.i5);const w=this.snapshotManager.betweenSnapshot.i.s5;_&&(_+=" "+w),r.items.item5in.textContent=_,this.activeItem(i.i.ai);let b="";if(this.myPlayer.getWeapon()===e.Pistol||this.myPlayer.getWeapon()===e.Rifle||this.myPlayer.getWeapon()===e.Machinegun||this.myPlayer.getWeapon()===e.Shotgun){let t=0;switch(this.myPlayer.getWeapon()){case e.Pistol:t=i.i.o;break;case e.Rifle:t=i.i.g;break;case e.Machinegun:t=i.i.b;break;case e.Shotgun:t=i.i.r}b=i.i.a.toString()+" / "+t}else this.myPlayer.getWeapon()===e.Hand||this.myPlayer.getWeapon()===e.Hammer?b="∞":this.myPlayer.getWeapon()===e.Granade||this.myPlayer.getWeapon()===e.Smoke?b=f.toString():this.myPlayer.getWeapon()===e.Medkit&&(b=w.toString());r.activeGunAmmo.textContent=b;let v=0;for(const e of this.snapshotManager.players)e.alive()&&v++;r.alive.textContent=v.toString();let S="none";if(1!==this.snapshotManager.betweenSnapshot.i.s)switch(S="block",this.snapshotManager.betweenSnapshot.i.s){case 2:r.items.scope2.style.display="block",r.items.scope4.style.display="none",r.items.scope6.style.display="none";break;case 4:r.items.scope2.style.display="none",r.items.scope4.style.display="block",r.items.scope6.style.display="none";break;case 6:r.items.scope2.style.display="none",r.items.scope4.style.display="none",r.items.scope6.style.display="block"}r.items.scope.style.display=S,S="none",this.snapshotManager.betweenSnapshot.i.v&&(S="block"),r.items.vest.style.display=S,this.snapshotManager.messageManager(),r.messages.innerHTML="";for(let e=this.snapshotManager.messages.length-1;e>=0;e--){const t=this.snapshotManager.messages[e],n=document.createElement("p");n.textContent=t.text,r.messages.appendChild(n)}if(this.snapshotManager.betweenSnapshot.z.hasOwnProperty("d")){let e="";this.snapshotManager.betweenSnapshot.z.d>0?e+=this.snapshotManager.betweenSnapshot.z.d:e="Zone is moving!",r.zoneTimer.innerText=e}r.spectate.style.display="none",i.i.spectateName&&(r.spectateName.innerText=i.i.spectateName,r.spectate.style.display="block")}drawHandOnWeapon(t,n,s){const i=this.ctxGame;let a=s+t.getAngle();t.getWeapon()===e.Hammer&&(a=s+t.getHammerAngle()),a>=360&&(a-=360);const o=Math.sin(a*Math.PI/180)*n,r=Math.cos(a*Math.PI/180)*n,l=t.getCenterX()+o-t.hands[0].radius,h=t.getCenterY()-r-t.hands[0].radius,{x:c,y:d,size:u,isOnScreen:m}=this.howToDraw({x:l,y:h,size:t.hands[0].size});if(m){const e=u/2;i.beginPath(),i.arc(c+e,d+e,e,0,2*Math.PI),i.fillStyle=this.colors.handBorder,i.fill();const t=.8*e;i.beginPath(),i.arc(c+e,d+e,t,0,2*Math.PI),i.fillStyle=this.colors.hand,i.fill()}}createBulletLines(){for(const e of this.snapshotManager.betweenSnapshot.b){let t=!1;for(const n of this.bulletLines)if(n.id===e.id){n.setEnd(e.x,e.y),t=!0;break}t||this.bulletLines.push(new p(e.id,e.x,e.y))}for(let e=this.bulletLines.length-1;e>=0;e--)this.bulletLines[e].isActive()||this.bulletLines.splice(e,1)}activeItem(e){const t=this.myHtmlElements;switch(t.items.item1.classList.remove("active"),t.items.item2.classList.remove("active"),t.items.item3.classList.remove("active"),t.items.item4.classList.remove("active"),t.items.item5.classList.remove("active"),e){case 1:t.items.item1.classList.add("active");break;case 2:t.items.item2.classList.add("active");break;case 3:t.items.item3.classList.add("active");break;case 4:t.items.item4.classList.add("active");break;case 5:t.items.item5.classList.add("active")}}itemAmmoColor(t,n){let s;1===t?s=this.myHtmlElements.items.item1Ammo:2===t&&(s=this.myHtmlElements.items.item2Ammo);let i="transparent";switch(n){case e.Pistol:i="orange";break;case e.Machinegun:i="blue";break;case e.Rifle:i="Green";break;case e.Shotgun:i="red"}s&&(s.style.background=i)}itemName(t){let n="";return t===e.Pistol&&(n="Pistol"),t===e.Rifle&&(n="Rifle"),t===e.Machinegun&&(n="Machinegun"),t===e.Shotgun&&(n="Shotgun"),t===e.Granade&&(n="Granade"),t===e.Smoke&&(n="Smoke"),t===e.Hand&&(n="Hands"),t===e.Hammer&&(n="Hammer"),t===e.Medkit&&(n="Medkit"),n}takeLootInfo(){const e=this.myHtmlElements;let t="";if(this.snapshotManager.betweenSnapshot&&this.myPlayer.alive()){for(const n of this.snapshotManager.betweenSnapshot.l){const i=this.myPlayer.getCenterX()-(n.x+n.size/2),a=this.myPlayer.getCenterY()-(n.y+n.size/2);if(Math.sqrt(i*i+a*a)<this.snapshotManager.players[0].radius+n.size/2){let i="";switch(n.type){case s.BlueAmmo:case s.RedAmmo:case s.GreenAmmo:case s.OrangeAmmo:i="Ammo";break;case s.Pistol:i="Pistol";break;case s.Rifle:i="Rifle";break;case s.Machinegun:i="Machinegun";break;case s.Shotgun:i="Shotgun";break;case s.Scope2:i="2X scope";break;case s.Scope4:i="4X scope";break;case s.Scope6:i="6X scope";break;case s.Granade:i="Granade";break;case s.Smoke:i="Smoke";break;case s.Medkit:i="Medkit";break;case s.Vest:i="Vest";break;case s.Hammer:i="Hammer"}let a="";return n.quantity&&(a+=n.quantity),t=i+" "+a+" (E)",void(e.takeLoot.innerText=t)}}e.takeLoot.innerText=t}else e.takeLoot.innerText=t}howToDraw(e){let t=0,n=0,s=0;e.size?(t=e.size*this.finalResolutionAdjustment,n=t,s=t):(n=e.width*this.finalResolutionAdjustment,s=e.height*this.finalResolutionAdjustment);const i=this.screenCenterX+(e.x-this.myPlayer.getCenterX())*this.finalResolutionAdjustment,a=this.screenCenterY+(e.y-this.myPlayer.getCenterY())*this.finalResolutionAdjustment;let o=!0;return(i>this.gameScreen.width||i<-n||a>this.gameScreen.height||a<-s)&&(o=!1),{x:i,y:a,size:t,width:n,height:s,isOnScreen:o}}gameOver(e,t,n){setTimeout((()=>{const s=this.myHtmlElements;t||n?(s.gameOverMenu.h1.textContent="Winner!",n&&(s.gameOverMenu.h1.textContent=n+" win"),s.gameOverMenu.spectate.style.display="none"):(s.gameOverMenu.h1.textContent="You died",s.gameOverMenu.spectate.style.display="block"),s.open(s.gameOverMenu.main),s.gameOverMenu.stats.innerHTML="";const i=document.createElement("p");i.textContent="Kills: "+e.kills.toString();const a=document.createElement("p");a.textContent="Damage dealt: "+e.damageDealt.toString();const o=document.createElement("p");o.textContent="Damage taken: "+e.damageTaken.toString();const r=document.createElement("p"),l=Math.floor(e.survive/60),h=l+"m "+(e.survive-60*l)+"s";r.textContent="Survive: "+h,s.gameOverMenu.stats.appendChild(i),s.gameOverMenu.stats.appendChild(a),s.gameOverMenu.stats.appendChild(o),t||s.gameOverMenu.stats.appendChild(r)}),2e3)}}class _{constructor(e){this.blocks=[],this.terrain=[],this.impassableRoundObstacles=[],this.bushes=[],this.trees=[],this.rocks=[],this.rectangleObstacles=[],this.waterTerrainData=e}reset(){this.blocks.splice(0,this.blocks.length),this.terrain.splice(0,this.terrain.length),this.impassableRoundObstacles.splice(0,this.impassableRoundObstacles.length),this.bushes.splice(0,this.bushes.length),this.trees.splice(0,this.trees.length),this.rocks.splice(0,this.rocks.length),this.rectangleObstacles.splice(0,this.rectangleObstacles.length)}getSize(){return this.size}getBlockSize(){return this.blockSize}openMap(e){this.size=e.size*e.blockSize,this.blockSize=e.blockSize;for(let t=0;t<e.size;t++)for(let n=0;n<e.size;n++)this.blocks.push({x:n*e.blockSize,y:t*e.blockSize});for(const t of e.terrains)this.terrain.push(new a(t.type,t.x,t.y,t.size));let t=0;for(const n of e.rocks){const e=new l(t++,n.x,n.y);this.rocks.push(e),this.impassableRoundObstacles.push(e)}for(const n of e.bushes)this.bushes.push(new h(t++,n.x,n.y,n.angle));for(const n of e.trees){const e=new r(t++,n.x,n.y,n.angle);this.trees.push(e),this.impassableRoundObstacles.push(e)}for(const n of e.rects)this.rectangleObstacles.push(new d(t++,n.x,n.y,n.width,n.height))}}class w{constructor(){this.waterTriangle1=[],this.waterTriangle2=[],this.waterTriangle3=[],this.waterTriangle4=[]}setData(e,n){switch(e){case t.WaterTriangle1:this.waterTriangle1=n;break;case t.WaterTriangle2:this.waterTriangle2=n;break;case t.WaterTriangle3:this.waterTriangle3=n;break;case t.WaterTriangle4:this.waterTriangle4=n;break;default:throw new Error("Unknown water type")}}includeWater(e,n,s){let i,a=!1;switch(e){case t.WaterTriangle1:i=this.waterTriangle1;break;case t.WaterTriangle2:i=this.waterTriangle2;break;case t.WaterTriangle3:i=this.waterTriangle3;break;case t.WaterTriangle4:i=this.waterTriangle4;break;default:throw new Error("Unknown water type")}if(n<i.length&&s<i[n].length)i[n][s]&&(a=!0);else{if(0!==i.length)throw new Error("Out of range on water type");a=!0}return a}}class b{constructor(){this.body=[],this.hand=[],this.hammer=[],this.ready=!1}setData(e,t,n){this.body=e,this.hand=t,this.hammer=n,this.ready=!0}isReady(){return this.ready}}class v{constructor(e,t,n){this.x=e,this.y=t,this.size=n,this.radius=n/2}setX(e){this.x=e}setY(e){this.y=e}getX(){return this.x}getY(){return this.y}getCenterX(){return this.x+this.radius}getCenterY(){return this.y+this.radius}}class S{constructor(){this.size=8,this.timer=0,this.timerMax=60,this.x=-1*Math.round(30*Math.random()),this.y=Math.round(30*Math.random())}shift(){this.x+=.7,this.y-=.7,this.timer++}getX(){return this.x}getY(){return this.y}getTimer(){return this.timer}}class k{constructor(e){this.live=!0,this.hands=[],this.bloods=[],this.vest=!1,this.id=e.i,this.x=e.x,this.y=e.y,this.angle=e.a,this.hammerAngle=e.m,this.weapon=e.w,this.size=e.size,this.radius=this.size/2,this.hands.push(new v(e.lX,e.lY,e.hSize)),this.hands.push(new v(e.rX,e.rY,e.hSize))}createInjury(e){for(let t=0;t<e/2;t++)this.bloods.push(new S)}getVest(){return this.vest}setVest(e){this.vest=e}die(){this.live=!1}alive(){return this.live}setX(e){this.x=e}setY(e){this.y=e}setAngle(e){this.angle=e}setHammerAngle(e){this.hammerAngle=e}setWeapon(e){this.weapon=e}getX(){return this.x}getY(){return this.y}getAngle(){return this.angle}getHammerAngle(){return this.hammerAngle}getWeapon(){return this.weapon}getCenterX(){return this.x+this.radius}getCenterY(){return this.y+this.radius}}class M{constructor(e,t,n){this.centerX=e,this.centerY=t,this.radius=n}setCenterX(e){this.centerX=e}setCenterY(e){this.centerY=e}setRadius(e){this.radius=e}getCenterX(){return this.centerX}getCenterY(){return this.centerY}getRadius(){return this.radius}}class A{constructor(){this.innerCircle=new M(0,0,0),this.outerCircle=new M(0,0,0)}}class x{constructor(e,t){this.time=e,this.text=t}}class T{constructor(e){this.size=30,this.opacity=1,this.centerX=e.x,this.centerY=e.y}getX(){return this.centerX-this.size/2}getY(){return this.centerY-this.size/2}getSize(){return this.size}getOpacity(){return this.opacity}flow(e=1){this.size+=2*e,this.opacity-=.02*e}isActive(){return this.opacity>.04}}class I{constructor(e,t){this.snapshots=[],this.messages=[],this.players=[],this.waterCircles=[],this.soundsToPlay=[],this.newerExists=!1,this.olderExists=!1,this.sumaNewer=0,this.averageSumaNewer=[],this.serverClientSync=e,this.zone=new A,this.map=t}getMyPlayer(e){for(const t of this.players)if(t.id===e)return t;return null}addSumaNewer(e){if(this.averageSumaNewer.push(e),this.averageSumaNewer.length>100){this.averageSumaNewer.splice(0,1);let e=0;for(const t of this.averageSumaNewer)e+=t;console.log("averageSumaNewer: ",e/100)}}reset(){this.snapshots.splice(0,this.snapshots.length),this.players.splice(0,this.players.length),this.betweenSnapshot=null,this.beforeSnapshotForTestBullets=null}messageManager(){for(let e=this.messages.length-1;e>=0;e--)this.messages[e].time+5e3<Date.now()&&this.messages.splice(e,1);if(this.messages.length>5){const e=this.messages.length-5;this.messages.splice(0,e)}}addSnapshot(e){let t=this.serverClientSync.getDrawDelay()-(this.serverClientSync.getServerTime()-e.t);if(t<0&&(t=0),e.sounds)for(const n of e.sounds)setTimeout((()=>{this.soundsToPlay.push(n)}),t);if(e.w)for(const n of e.w)setTimeout((()=>{this.waterCircles.push(new T(n))}),t);for(let e=this.waterCircles.length-1;e>=0;e--)this.waterCircles[e].isActive()||this.waterCircles.splice(e,1);if(e.p)for(const n of e.p)n.d&&setTimeout((()=>{for(const e of this.players)if(e.id===n.i){e.createInjury(n.d);break}}),t),n.hasOwnProperty("v")&&setTimeout((()=>{for(const e of this.players)if(e.id===n.i){let t=!1;1===n.v&&(t=!0),e.setVest(t);break}}),t);if(this.snapshots.push(e),this.snapshots.length>1&&this.completeSnapshot(this.snapshots[this.snapshots.length-2],e),e.m)for(const n of e.m)setTimeout((()=>{this.messages.push(new x(Date.now(),n))}),t);this.updateMap(e,t),this.snapshots.length>50&&this.snapshots.splice(0,1)}updateMap(e,t){const n=e.o;for(const e of n)switch(e.t){case"w":for(const n of this.map.rectangleObstacles)if(n.id===e.i){setTimeout((()=>{n.update(e.o)}),t);break}break;case"r":for(const n of this.map.rocks)if(n.id===e.i){setTimeout((()=>{n.update(e.o)}),t);break}break;case"t":for(const n of this.map.trees)if(n.id===e.i){setTimeout((()=>{n.update(e.o)}),t);break}break;case"b":for(const n of this.map.bushes)if(n.id===e.i){setTimeout((()=>{n.update(e.o)}),t);break}}}updateZone(){if(!this.betweenSnapshot)return;const e=this.betweenSnapshot.z;this.zone.innerCircle.setRadius(e.iR),this.zone.innerCircle.setCenterX(e.iX),this.zone.innerCircle.setCenterY(e.iY),this.zone.outerCircle.setRadius(e.oR),this.zone.outerCircle.setCenterX(e.oX),this.zone.outerCircle.setCenterY(e.oY)}completeSnapshot(e,t){this.completePlayerSnapshots(e.p,t.p),this.completeMyPlayerSnapshot(e.i,t.i),this.completeLootSnapshots(e.l,t.l),this.completeZoneSnapshot(e.z,t.z),t.z.hasOwnProperty("d")||(t.z.d=e.z.d)}completeMyPlayerSnapshot(e,t){t.hasOwnProperty("h")||(t.h=e.h),t.hasOwnProperty("i1")||(t.i1=e.i1),t.hasOwnProperty("i2")||(t.i2=e.i2),t.hasOwnProperty("i3")||(t.i3=e.i3),t.hasOwnProperty("i4")||(t.i4=e.i4),t.hasOwnProperty("i5")||(t.i5=e.i5),t.hasOwnProperty("s4")||(t.s4=e.s4),t.hasOwnProperty("s5")||(t.s5=e.s5),t.hasOwnProperty("a")||(t.a=e.a),t.hasOwnProperty("aM")||(t.aM=e.aM),t.hasOwnProperty("r")||(t.r=e.r),t.hasOwnProperty("g")||(t.g=e.g),t.hasOwnProperty("b")||(t.b=e.b),t.hasOwnProperty("o")||(t.o=e.o),t.hasOwnProperty("s")||(t.s=e.s),t.hasOwnProperty("v")||(t.v=e.v),t.hasOwnProperty("l")||(t.l=e.l),t.hasOwnProperty("lE")||(t.lE=e.lE),t.hasOwnProperty("lT")||(t.lT=e.lT),t.hasOwnProperty("spectate")||(t.spectate=e.spectate),t.hasOwnProperty("spectateName")||(t.spectateName=e.spectateName),t.hasOwnProperty("ai")||(t.ai=e.ai)}completeZoneSnapshot(e,t){t.hasOwnProperty("iX")||(t.iX=e.iX),t.hasOwnProperty("iY")||(t.iY=e.iY),t.hasOwnProperty("iR")||(t.iR=e.iR),t.hasOwnProperty("oX")||(t.oX=e.oX),t.hasOwnProperty("oY")||(t.oY=e.oY),t.hasOwnProperty("oR")||(t.oR=e.oR)}completeLootSnapshots(e,t){for(const n of t){let t;for(const s of e)s.i===n.i&&(t=s);t&&(n.hasOwnProperty("size")||(n.size=t.size),n.hasOwnProperty("type")||(n.type=t.type),n.hasOwnProperty("x")||(n.x=t.x),n.hasOwnProperty("y")||(n.y=t.y),!n.hasOwnProperty("quantity")&&t.hasOwnProperty("quantity")&&(n.quantity=t.quantity))}const n=[];for(const s of e){let e=!1;for(const n of t)if(s.i===n.i){e=!0;break}e||n.push(s)}for(const e of n)t.push(e);for(let e=t.length-1;e>=0;e--)t[e].hasOwnProperty("del")&&t.splice(e,1)}completePlayerSnapshots(e,t){for(const n of t){let t;for(const s of e)s.i===n.i&&(t=s);t&&(n.hasOwnProperty("a")||(n.a=t.a),n.hasOwnProperty("m")||(n.m=t.m),n.hasOwnProperty("size")||(n.size=t.size),n.hasOwnProperty("w")||(n.w=t.w),n.hasOwnProperty("x")||(n.x=t.x),n.hasOwnProperty("y")||(n.y=t.y),n.hasOwnProperty("l")||(n.l=t.l),n.hasOwnProperty("hSize")||(n.hSize=t.hSize),n.hasOwnProperty("lX")||(n.lX=t.lX),n.hasOwnProperty("lY")||(n.lY=t.lY),n.hasOwnProperty("rX")||(n.rX=t.rX),n.hasOwnProperty("rY")||(n.rY=t.rY))}const n=[];for(const s of e){let e=!1;for(const n of t)if(s.i===n.i){e=!0;break}e||n.push(s.i)}for(const s of n)for(const n of e)if(s===n.i){t.push(n);break}t.sort(((e,t)=>e.i-t.i))}createBetweenSnapshot(){if(this.snapshots.length&&this.serverClientSync.ready()){let e,t,n=0;this.sumaNewer=0,this.newerExists=!1,this.olderExists=!1;const s=this.serverClientSync.getServerTime()-this.serverClientSync.getDrawDelay();for(const e of this.snapshots)e.t<=s&&(t=e,this.olderExists=!0);for(const t of this.snapshots)t.t>=s&&(e||(e=t,this.newerExists=!0),this.sumaNewer++);if(e||(e=t),this.serverClientSync.changeSumaNewer(this.sumaNewer),t&&e){const i=e.t-t.t,a=s-t.t;i&&(n=a/i);const o=e;this.betweenSnapshot={t:o.t,i:Object.assign({},o.i),p:[],b:[],g:[],s:[],z:Object.assign({},o.z),l:[],o:[],sounds:[]};for(const e of o.p)this.betweenSnapshot.p.push(Object.assign({},e));for(const e of o.b)this.betweenSnapshot.b.push(Object.assign({},e));for(const e of o.g)this.betweenSnapshot.g.push(Object.assign({},e));for(const e of o.s)this.betweenSnapshot.s.push(Object.assign({},e));for(const e of o.l)this.betweenSnapshot.l.push(Object.assign({},e));for(let s=0;s<this.betweenSnapshot.p.length;s++){const i=this.betweenSnapshot.p[s];i.x=this.positionBetweenSnapshots(t.p[s].x,e.p[s].x,n),i.y=this.positionBetweenSnapshots(t.p[s].y,e.p[s].y,n),i.h||(i.lX=this.positionBetweenSnapshots(t.p[s].lX,e.p[s].lX,n),i.lY=this.positionBetweenSnapshots(t.p[s].lY,e.p[s].lY,n),i.rX=this.positionBetweenSnapshots(t.p[s].rX,e.p[s].rX,n),i.rY=this.positionBetweenSnapshots(t.p[s].rY,e.p[s].rY,n))}for(const s of this.betweenSnapshot.b){let i,a;for(const e of t.b)if(s.id===e.id){i=e;break}for(const t of e.b)if(s.id===t.id){a=t;break}i&&a&&(s.x=this.positionBetweenSnapshots(i.x,a.x,n),s.y=this.positionBetweenSnapshots(i.y,a.y,n))}for(const s of this.betweenSnapshot.l){let i,a;for(const e of t.l)if(s.i===e.i){i=e;break}for(const t of e.l)if(s.i===t.i){a=t;break}i&&a&&(s.x=this.positionBetweenSnapshots(i.x,a.x,n),s.y=this.positionBetweenSnapshots(i.y,a.y,n))}this.betweenSnapshot.z.oR=this.positionBetweenSnapshots(t.z.oR,e.z.oR,n),this.betweenSnapshot.z.oX=this.positionBetweenSnapshots(t.z.oX,e.z.oX,n),this.betweenSnapshot.z.oY=this.positionBetweenSnapshots(t.z.oY,e.z.oY,n)}}this.updatePlayers(),this.updateZone()}updatePlayers(){if(this.betweenSnapshot)for(const e of this.betweenSnapshot.p){let t=!1;for(const n of this.players)if(n.id===e.i){n.setX(e.x),n.setY(e.y),n.setAngle(e.a),n.setWeapon(e.w),n.setHammerAngle(e.m),0===e.l&&n.die(),n.hands[0].setX(e.lX),n.hands[0].setY(e.lY),n.hands[1].setX(e.rX),n.hands[1].setY(e.rY),t=!0;break}t||this.players.push(new k(e))}}positionBetweenSnapshots(e,t,n){let s=1;return t<e&&(s=-1),e+Math.abs(t-e)*s*n}}!function(e){e[e.Pistol=0]="Pistol",e[e.Shotgun=1]="Shotgun",e[e.Rifle=2]="Rifle",e[e.Machinegun=3]="Machinegun",e[e.Granade=4]="Granade",e[e.Punch=5]="Punch",e[e.Water=6]="Water",e[e.Hit=7]="Hit",e[e.Footstep=8]="Footstep",e[e.Hammer=9]="Hammer",e[e.Throw=10]="Throw"}(i||(i={}));var D,z=n(766);class E{constructor(){this.pistolShout=new z.Howl({src:["../sound/pistol.wav"],volume:0}),this.shotgunShout=new z.Howl({src:["../sound/shotgun.wav"],volume:0}),this.rifleShout=new z.Howl({src:["../sound/rifle.wav"],volume:0}),this.machinegunShout=new z.Howl({src:["../sound/machinegun.wav"],volume:0}),this.granadeShout=new z.Howl({src:["../sound/granade.wav"],volume:0}),this.punch=new z.Howl({src:["../sound/punch.wav"],volume:0}),this.water=new z.Howl({src:["../sound/water2.wav"],volume:0}),this.hit=new z.Howl({src:["../sound/hit.wav"],volume:0}),this.footstep=new z.Howl({src:["../sound/footstep.wav"],volume:0}),this.hammer=new z.Howl({src:["../sound/hammer.flac"],volume:0}),this.throw=new z.Howl({src:["../sound/throw.flac"],volume:0})}play(e,t,n){let s=this.pistolShout,a=1;switch(n.soundType){case i.Shotgun:s=this.shotgunShout;break;case i.Rifle:a=1.5,s=this.rifleShout;break;case i.Machinegun:a=1.2,s=this.machinegunShout;break;case i.Granade:s=this.granadeShout;break;case i.Punch:a=.9,s=this.punch;break;case i.Water:a=.3,s=this.water;break;case i.Hit:s=this.hit;break;case i.Footstep:a=1.5,s=this.footstep;break;case i.Hammer:s=this.hammer;break;case i.Throw:a=.8,s=this.throw}const o=Math.abs(e-n.x),r=Math.abs(t-n.y),l=3e3;let h=1-Math.abs(Math.sqrt(o*o+r*r))/l;h<0&&(h=0);const c=.15*h*a;let d=Math.abs(e-n.x),u=Math.abs(t-n.y);n.x<e&&(d*=-1),n.y<t&&(u*=-1);let m=d/l,p=u/l;Math.abs(m)>.01||Math.abs(p)>.01?s.pos(m,0,p):s.pos(0,0,0),s.volume(c),s.play()}}class G{constructor(e,t,n,s,i){this.spectate=!1,this.gameRun=!1,this.gameId=-1,this.playerId=-1,this.surroundSound=new E,this.socket=t,this.serverClientSync=n,this.waterTerrainData=new w,this.map=new _(this.waterTerrainData),this.snapshotManager=new I(n,this.map),this.mouse=e,this.myHtmlElements=s,this.editor=i,this.collisionPoints=new b,this.view=new f(this.map,this.mouse,this.waterTerrainData,this.myHtmlElements,this.collisionPoints,this.snapshotManager),setTimeout((()=>{this.loop()}),200)}reset(){const e=this.myHtmlElements;e.close(e.gameOverMenu.main),e.open(e.mainMenu.main,e.hideGame),e.gameOverMenu.stats.innerHTML="",this.gameRun=!1,this.gameId=-1,this.playerId=-1,this.map.reset(),this.snapshotManager.reset(),this.view.reset(),this.spectate=!1,this.serverClientSync.reset()}stop(){this.gameRun=!1}isNameOk(e){let t=!1;if("string"==typeof e&&e.length>0&&e.length<=20){let n=!1;for(let t=0;t<e.length;t++)if(-1==="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ".lastIndexOf(e[t])){n=!0;break}n||(t=!0)}return t}startSpectate(){this.spectate=!0}getSpectate(){return this.spectate}setName(e){this.name=e}getName(){return this.name}getGameId(){return this.gameId}setGameId(e){this.gameId=e}getPlayerId(){return this.playerId}setPlayerId(e){this.playerId=e}gameStart(){this.gameRun=!0,this.snapshotManager.reset()}gameActive(){return this.gameRun}loop(){if(requestAnimationFrame((()=>{this.loop()})),this.editor.isActive()&&this.view.drawEditor(this.editor),this.serverClientSync.ready()||Math.random()>.8&&this.socket.emit("serverClientSync",Date.now()),this.gameRun){this.snapshotManager.createBetweenSnapshot(),this.view.drawGame(this.playerId);for(const e of this.snapshotManager.soundsToPlay){const t=this.snapshotManager.getMyPlayer(this.playerId);this.surroundSound.play(t.getCenterX(),t.getCenterY(),e)}this.snapshotManager.soundsToPlay.splice(0,this.snapshotManager.soundsToPlay.length)}}}class P{constructor(){this.ping=0,this.pings=[],this.timeDiference=0,this.timeDiferences=[],this.pingAttempts=5,this.defaultDrawDelay=70,this.drawDelay=this.defaultDrawDelay,this.minWantedSumaNewerSnapshots=3,this.defaultWantedNewerSnapshots=5,this.wantedSumaNewerSnapshots=this.defaultWantedNewerSnapshots,this.maxWantedSumaNewerSnapshots=11,this.lags=0,this.maxLags=10,this.lastLagTime=0}getPing(){return this.ping}getTimeDiference(){return this.timeDiference}changeSumaNewer(e){switch(0===e&&(this.lags++,this.lastLagTime=Date.now()),this.lags===this.maxLags&&this.wantedSumaNewerSnapshots<this.maxWantedSumaNewerSnapshots&&(this.wantedSumaNewerSnapshots++,this.lags=0),this.lastLagTime&&this.lastLagTime+5e3<Date.now()&&this.wantedSumaNewerSnapshots>this.minWantedSumaNewerSnapshots&&(this.wantedSumaNewerSnapshots--,this.lags=0,this.lastLagTime=Date.now()),this.wantedSumaNewerSnapshots){case 3:0===e&&this.changeDrawDelay(5),1===e&&this.changeDrawDelay(.5),2===e&&this.changeDrawDelay(.2),4===e&&this.changeDrawDelay(-.2),5===e&&this.changeDrawDelay(-.5),6===e&&this.changeDrawDelay(-2),7===e&&this.changeDrawDelay(-2),8===e&&this.changeDrawDelay(-5),e>8&&this.changeDrawDelay(-10);break;case 4:0===e&&this.changeDrawDelay(5),1===e&&this.changeDrawDelay(2),2===e&&this.changeDrawDelay(.5),3===e&&this.changeDrawDelay(.2),5===e&&this.changeDrawDelay(-.2),6===e&&this.changeDrawDelay(-.5),7===e&&this.changeDrawDelay(-2),8===e&&this.changeDrawDelay(-2),9===e&&this.changeDrawDelay(-5),e>9&&this.changeDrawDelay(-10);break;case 5:0===e&&this.changeDrawDelay(5),1===e&&this.changeDrawDelay(2),2===e&&this.changeDrawDelay(1),3===e&&this.changeDrawDelay(.5),4===e&&this.changeDrawDelay(.2),6===e&&this.changeDrawDelay(-.2),7===e&&this.changeDrawDelay(-.5),8===e&&this.changeDrawDelay(-2),9===e&&this.changeDrawDelay(-2),10===e&&this.changeDrawDelay(-5),e>10&&this.changeDrawDelay(-10);break;case 6:0===e&&this.changeDrawDelay(5),1===e&&this.changeDrawDelay(2),2===e&&this.changeDrawDelay(1),3===e&&this.changeDrawDelay(.5),4===e&&this.changeDrawDelay(.5),5===e&&this.changeDrawDelay(.2),7===e&&this.changeDrawDelay(-.2),8===e&&this.changeDrawDelay(-.5),9===e&&this.changeDrawDelay(-2),10===e&&this.changeDrawDelay(-2),11===e&&this.changeDrawDelay(-5),e>11&&this.changeDrawDelay(-10);break;case 7:0===e&&this.changeDrawDelay(5),1===e&&this.changeDrawDelay(2),2===e&&this.changeDrawDelay(1),3===e&&this.changeDrawDelay(.5),4===e&&this.changeDrawDelay(.5),5===e&&this.changeDrawDelay(.2),6===e&&this.changeDrawDelay(.2),8===e&&this.changeDrawDelay(-.2),9===e&&this.changeDrawDelay(-.5),10===e&&this.changeDrawDelay(-2),11===e&&this.changeDrawDelay(-2),12===e&&this.changeDrawDelay(-5),e>12&&this.changeDrawDelay(-10);break;case 8:0===e&&this.changeDrawDelay(5),1===e&&this.changeDrawDelay(2),2===e&&this.changeDrawDelay(1),3===e&&this.changeDrawDelay(1),4===e&&this.changeDrawDelay(.5),5===e&&this.changeDrawDelay(.5),6===e&&this.changeDrawDelay(.2),7===e&&this.changeDrawDelay(.2),9===e&&this.changeDrawDelay(-.2),10===e&&this.changeDrawDelay(-.5),11===e&&this.changeDrawDelay(-2),12===e&&this.changeDrawDelay(-2),13===e&&this.changeDrawDelay(-5),e>13&&this.changeDrawDelay(-10);break;case 9:0===e&&this.changeDrawDelay(5),1===e&&this.changeDrawDelay(2),2===e&&this.changeDrawDelay(2),3===e&&this.changeDrawDelay(1),4===e&&this.changeDrawDelay(1),5===e&&this.changeDrawDelay(.5),6===e&&this.changeDrawDelay(.5),7===e&&this.changeDrawDelay(.2),8===e&&this.changeDrawDelay(.2),10===e&&this.changeDrawDelay(-.2),11===e&&this.changeDrawDelay(-.5),12===e&&this.changeDrawDelay(-2),13===e&&this.changeDrawDelay(-2),14===e&&this.changeDrawDelay(-5),e>14&&this.changeDrawDelay(-10);break;case 10:0===e&&this.changeDrawDelay(5),1===e&&this.changeDrawDelay(5),2===e&&this.changeDrawDelay(2),3===e&&this.changeDrawDelay(2),4===e&&this.changeDrawDelay(1),5===e&&this.changeDrawDelay(1),6===e&&this.changeDrawDelay(.5),7===e&&this.changeDrawDelay(.5),8===e&&this.changeDrawDelay(.2),9===e&&this.changeDrawDelay(.2),11===e&&this.changeDrawDelay(-.2),12===e&&this.changeDrawDelay(-.5),13===e&&this.changeDrawDelay(-2),14===e&&this.changeDrawDelay(-2),15===e&&this.changeDrawDelay(-5),e>5&&this.changeDrawDelay(-10);break;case 11:0===e&&this.changeDrawDelay(10),1===e&&this.changeDrawDelay(5),2===e&&this.changeDrawDelay(2),3===e&&this.changeDrawDelay(2),4===e&&this.changeDrawDelay(2),5===e&&this.changeDrawDelay(1),6===e&&this.changeDrawDelay(1),7===e&&this.changeDrawDelay(.5),8===e&&this.changeDrawDelay(.5),9===e&&this.changeDrawDelay(.2),10===e&&this.changeDrawDelay(.2),12===e&&this.changeDrawDelay(-.2),13===e&&this.changeDrawDelay(-.5),14===e&&this.changeDrawDelay(-2),15===e&&this.changeDrawDelay(-2),16===e&&this.changeDrawDelay(-5),e>16&&this.changeDrawDelay(-10)}}ready(){return this.pings.length===this.pingAttempts}reset(){this.pings=[],this.timeDiferences=[],this.ping=0,this.timeDiference=0,this.drawDelay=this.defaultDrawDelay,this.wantedSumaNewerSnapshots=this.defaultWantedNewerSnapshots,this.lags=0,this.lastLagTime=0}addData(e,t){if(this.ready()||(this.pings.push(e),this.timeDiferences.push(t)),this.pings.length===this.pingAttempts){let e=0;for(const t of this.pings)e+=t;this.ping=e/this.pingAttempts;let t=0;for(const e of this.timeDiferences)t+=e;this.timeDiference=t/this.pingAttempts}}changeDrawDelay(e){this.drawDelay+=e}getDrawDelay(){return this.drawDelay}getServerTime(){let e=Date.now();return this.ready()&&(e+=this.getTimeDiference()),e}}class O{constructor(){this.healthBar={main:document.getElementById("healthBar"),in:document.getElementById("healthBarIn")},this.items={redAmmo:document.getElementById("redAmmo"),greenAmmo:document.getElementById("greenAmmo"),blueAmmo:document.getElementById("blueAmmo"),orangeAmmo:document.getElementById("orangeAmmo"),item1:document.getElementById("item1"),item2:document.getElementById("item2"),item3:document.getElementById("item3"),item4:document.getElementById("item4"),item5:document.getElementById("item5"),item1in:document.getElementById("item1").getElementsByTagName("span")[0],item2in:document.getElementById("item2").getElementsByTagName("span")[0],item3in:document.getElementById("item3").getElementsByTagName("span")[0],item4in:document.getElementById("item4").getElementsByTagName("span")[0],item5in:document.getElementById("item5").getElementsByTagName("span")[0],item1Ammo:document.getElementById("item1Ammo"),item2Ammo:document.getElementById("item2Ammo"),scope:document.getElementById("scope"),scope2:document.getElementById("scope2"),scope4:document.getElementById("scope4"),scope6:document.getElementById("scope6"),scopeSVG:document.getElementById("scope").getElementsByTagName("img")[0],vest:document.getElementById("vest")},this.editor={coordinates:document.getElementById("editorCoordinates"),container:document.getElementById("editorContainer"),screen:document.getElementById("editorScreen"),terrainImgs:document.getElementById("editorTerrainImgs"),terrainWater:document.getElementById("terrainWater"),terrainGrass:document.getElementById("terrainGrass"),terrainWaterTriangle1:document.getElementById("terrainWaterTriangle1"),terrainWaterTriangle2:document.getElementById("terrainWaterTriangle2"),terrainWaterTriangle3:document.getElementById("terrainWaterTriangle3"),terrainWaterTriangle4:document.getElementById("terrainWaterTriangle4"),objectImgs:document.getElementById("editorObjectImgs"),objectBush:document.getElementById("editorObjectBush"),objectRock:document.getElementById("editorObjectRock"),objectTree:document.getElementById("editorObjectTree"),objectRect:document.getElementById("editorObjectRect"),objectHorizontalWall:document.getElementById("editorObjectHorizontalWall"),objectVerticalWall:document.getElementById("editorObjectVerticalWall"),objectDelete:document.getElementById("editorObjectDelete"),openMenu:document.getElementById("editorOpenMenu")},this.saveMapMenu={main:document.getElementById("saveMapMenu"),back:document.getElementById("saveMapMenuBack")},this.gameOverMenu={main:document.getElementById("gameOverMenu"),back:document.getElementById("gameOverMenuBack"),h1:document.getElementById("gameOverMenuH1"),stats:document.getElementById("gameOverMenuStats"),spectate:document.getElementById("gameOverMenuspectate")},this.mapEditorMenu={main:document.getElementById("mapEditorMenu"),name:document.getElementById("mapEditorMenuName"),save:document.getElementById("mapEditorMenuSave"),changeSize:document.getElementById("mapEditorMenuChangeSize"),back:document.getElementById("mapEditorMenuBack"),close:document.getElementById("mapEditorMenuClose")},this.alertMenu={main:document.getElementById("alertMenu"),ok:document.getElementById("alertMenuOk")},this.openMapMenu={main:document.getElementById("openMapMenu"),maps:document.getElementById("openMapMenuMaps"),ok:document.getElementById("openMapMenuOk"),back:document.getElementById("openMapMenuBack")},this.controlsMenu={main:document.getElementById("controlsMenu"),back:document.getElementById("controlsMenuBack")},this.mainMenu={main:document.getElementById("mainMenu"),ip:document.getElementById("mainMenuIp"),name:document.getElementById("mainMenuName"),games:document.getElementById("mainMenuGames"),join:document.getElementById("mainMenuJoin"),maps:document.getElementById("mainMenuMaps"),create:document.getElementById("mainMenuCreate"),openEditor:document.getElementById("mainMenuOpenEditor"),controls:document.getElementById("mainMenuControls")},this.gameCanceledMenu={main:document.getElementById("cancelLobbyMenu"),back:document.getElementById("cancelLobbyMenuBack")},this.mapSizeMenu={main:document.getElementById("mapSizeMenu"),value:document.getElementById("mapSizeValue"),ok:document.getElementById("mapSizeOk"),back:document.getElementById("mapSizeBack")},this.mapMenu={main:document.getElementById("mapMenu"),create:document.getElementById("mapMenuCreate"),open:document.getElementById("mapMenuOpenMap"),back:document.getElementById("mapMenuBack")},this.lobbyMenu={main:document.getElementById("lobbyMenu"),gameName:document.getElementById("lobbyMenuGameName"),mapName:document.getElementById("lobbyMapName"),players:document.getElementById("lobbyMenuPlayers"),forJoinPlayers:document.getElementById("lobbyMenuForJoinPlayer"),leave:document.getElementById("lobbyMenuLeave"),forCreatePlayer:document.getElementById("lobbyMenuForCreatePlayer"),start:document.getElementById("lobbyMenuStart"),cancel:document.getElementById("lobbyMenuCancel")},this.loading={main:document.getElementById("loading"),counter:document.getElementById("loadingCounter"),circle:document.getElementById("loadingCircle"),text:document.getElementById("loadingText")},this.escFromGameMenu={main:document.getElementById("escFromGame"),back:document.getElementById("escFromGameBack"),leave:document.getElementById("escFromGameLeave")},this.gameScreen=document.getElementById("gameScreen"),this.mapScreen=document.getElementById("mapScreen"),this.helperScreen=document.getElementById("helperScreen"),this.zoneSVG=document.getElementById("zoneSVG"),this.zoneCircle=document.getElementById("zoneCircle"),this.zoneRect=document.getElementById("zoneRect"),this.mapZoneSVG=document.getElementById("mapZoneSVG"),this.mapZoneCircle=document.getElementById("mapZoneCircle"),this.takeLoot=document.getElementById("takeLoot"),this.transparentLayer=document.getElementById("transparentLayer"),this.activeGunAmmo=document.getElementById("activeGunAmmo"),this.mapContainer=document.getElementById("mapContainer"),this.alive=document.getElementById("alive"),this.messages=document.getElementById("messages"),this.zoneTimer=document.getElementById("zoneTimer"),this.spectate=document.getElementById("spectate"),this.spectateName=document.getElementById("spectateName"),this.hideGame=document.getElementById("hideGame"),this.itNetwork=document.getElementById("itnetwork")}close(...e){for(const t of e)t.style.display="none"}open(...e){for(const t of e)t.style.display="block"}}class C{constructor(e,t,n,s,i,a,o){this.size=e,this.blockSize=t,this.terrains=n,this.rects=s,this.bushes=i,this.rocks=a,this.trees=o}}class L{constructor(e,t){this.active=!1,this.blockSize=300,this.terrains=[],this.bushes=[],this.rocks=[],this.trees=[],this.walls=[],this.myHtmlElements=e,this.socket=t,this.colors=new u,this.bush=new h(0,0,0,0),this.rock=new l(0,0,0),this.tree=new r(0,0,0,0),this.horizontalWall=new d(0,0,0,306,72.5),this.verticalWall=new d(0,0,0,72.5,306),this.controller()}isActive(){return this.active}close(){this.active=!1}getTerrainType(){return this.terrainType}getObjectType(){return this.objectType}getSize(){return this.size}getX(){return this.x}getY(){return this.y}getMapData(){return new C(this.size,this.blockSize,this.terrains,this.walls,this.bushes,this.rocks,this.trees)}create(){this.cleanMap()}changeSize(e){this.active=!0;const t=this.myHtmlElements;this.size=e,t.editor.screen.width=e*this.blockSize,t.editor.screen.height=e*this.blockSize;const n=(e*this.blockSize).toString();t.editor.screen.style.width=n;const s=(e*this.blockSize).toString();t.editor.screen.style.width=s,this.cleanMapAfterChangeSize()}cleanMap(){this.terrains=[],this.bushes=[],this.rocks=[],this.trees=[],this.walls=[]}cleanMapAfterChangeSize(){const e=this.size*this.blockSize;let t=this.terrains;for(let n=t.length-1;n>=0;n--){const s=t[n];(s.x>=e||s.y>=e)&&t.splice(n,1)}t=this.trees;for(let n=t.length-1;n>=0;n--){const s=t[n];(s.x>=e||s.y>=e)&&t.splice(n,1)}t=this.rocks;for(let n=t.length-1;n>=0;n--){const s=t[n];(s.x>=e||s.y>=e)&&t.splice(n,1)}t=this.bushes;for(let n=t.length-1;n>=0;n--){const s=t[n];(s.x>=e||s.y>=e)&&t.splice(n,1)}t=this.walls;for(let n=t.length-1;n>=0;n--){const s=t[n];(s.x>=e||s.y>=e)&&t.splice(n,1)}}openMap(e){this.create(),this.changeSize(e.size);let t=0;for(const n of e.rocks)this.rocks.push(new l(t++,n.x,n.y));for(const n of e.trees)this.trees.push(new r(t++,n.x,n.y,n.angle));for(const n of e.bushes)this.bushes.push(new h(t++,n.x,n.y,n.angle));for(const n of e.rects)this.walls.push(new d(t++,n.x,n.y,n.width,n.height));for(const t of e.terrains)this.terrains.push(new a(t.type,t.x,t.y,t.size));this.cleanMapAfterChangeSize()}controller(){const e=this.myHtmlElements;e.editor.screen.addEventListener("mousemove",(t=>{const n=e.editor.screen.getBoundingClientRect();this.x=t.clientX+e.editor.screen.scrollLeft-n.left,this.y=t.clientY+e.editor.screen.scrollTop-n.top,e.editor.coordinates.innerText=`x: ${this.x} y: ${this.y}`})),e.editor.terrainImgs.addEventListener("click",(n=>{const s=e.editor.terrainImgs.children;for(let e=0;e<s.length;e++)s[e].style.borderColor=this.colors.blockFrame;const i=e.editor.objectImgs.children;for(let e=0;e<i.length;e++)i[e].style.borderColor=this.colors.blockFrame;switch(n.target.style.borderColor=this.colors.blockFrameActive,this.objectType=null,n.target){case e.editor.terrainWater:this.terrainType=t.Water;break;case e.editor.terrainGrass:this.terrainType=t.Grass;break;case e.editor.terrainWaterTriangle1:this.terrainType=t.WaterTriangle1;break;case e.editor.terrainWaterTriangle2:this.terrainType=t.WaterTriangle2;break;case e.editor.terrainWaterTriangle3:this.terrainType=t.WaterTriangle3;break;case e.editor.terrainWaterTriangle4:this.terrainType=t.WaterTriangle4}})),e.editor.objectImgs.addEventListener("click",(t=>{const n=e.editor.terrainImgs.children;for(let e=0;e<n.length;e++)n[e].style.borderColor=this.colors.blockFrame;const s=e.editor.objectImgs.children;for(let e=0;e<s.length;e++)s[e].style.borderColor=this.colors.blockFrame;switch(t.target.style.borderColor=this.colors.blockFrameActive,this.terrainType=null,t.target){case e.editor.objectBush:this.objectType="bush";break;case e.editor.objectRock:this.objectType="rock";break;case e.editor.objectTree:this.objectType="tree";break;case e.editor.objectRect:this.objectType="rect";break;case e.editor.objectHorizontalWall:this.objectType="horizontalWall";break;case e.editor.objectVerticalWall:this.objectType="verticalWall";break;case e.editor.objectDelete:this.objectType="delete"}})),e.editor.screen.addEventListener("click",(()=>{if(null!=this.getTerrainType()){const e=Math.floor(this.getX()/this.blockSize)*this.blockSize,n=Math.floor(this.getY()/this.blockSize)*this.blockSize;let s=-1;for(let t=0;t<this.terrains.length;t++){const i=this.terrains[t];if(i.x===e&&i.y===n){s=t;break}}-1!==s&&this.terrains.splice(s,1),this.getTerrainType()!==t.Grass&&this.terrains.push(new a(this.getTerrainType(),e,n,this.blockSize))}if(null!=this.getObjectType()){const e=Math.floor(360*Math.random());switch(this.getObjectType()){case"bush":this.bushes.push(new h(0,this.x-this.bush.size/2,this.y-this.bush.size/2,e));break;case"rock":this.rocks.push(new l(0,this.x-this.rock.size/2,this.y-this.rock.size/2));break;case"tree":this.trees.push(new r(0,this.x-this.tree.size/2,this.y-this.tree.size/2,e));break;case"rect":this.walls.push(new d(0,this.x-this.bush.size/2,this.y-this.bush.size/2,100,100));break;case"horizontalWall":this.walls.push(new d(0,this.x-this.horizontalWall.width/2,this.y-this.horizontalWall.height/2,this.horizontalWall.width,this.horizontalWall.height));break;case"verticalWall":this.walls.push(new d(0,this.x-this.verticalWall.width/2,this.y-this.verticalWall.height/2,this.verticalWall.width,this.verticalWall.height));break;case"delete":let t;const n=this;for(const e of n.rocks){const s=e;s.x<=n.getX()&&s.x+s.size>=n.getX()&&s.y<=n.getY()&&s.y+s.size>=n.getY()&&(t=s)}for(const e of n.walls){const s=e;s.x<=n.getX()&&s.x+s.width>=n.getX()&&s.y<=n.getY()&&s.y+s.height>=n.getY()&&(t=s)}for(const e of n.bushes){const s=e;s.x<=n.getX()&&s.x+s.size>=n.getX()&&s.y<=n.getY()&&s.y+s.size>=n.getY()&&(t=s)}for(const e of n.trees){const s=e;s.x<=n.getX()&&s.x+s.size>=n.getX()&&s.y<=n.getY()&&s.y+s.size>=n.getY()&&(t=s)}let s=-1;for(let e=0;e<this.rocks.length;e++)t==this.rocks[e]&&(s=e);-1!==s&&(this.rocks.splice(s,1),s=-1);for(let e=0;e<this.bushes.length;e++)t==this.bushes[e]&&(s=e);-1!==s&&(this.bushes.splice(s,1),s=-1);for(let e=0;e<this.trees.length;e++)t==this.trees[e]&&(s=e);-1!==s&&(this.trees.splice(s,1),s=-1);for(let e=0;e<this.walls.length;e++)t==this.walls[e]&&(s=e);-1!==s&&(this.walls.splice(s,1),s=-1)}}})),this.socket.on("openMapInEditor",(t=>{this.openMap(t),e.close(e.openMapMenu.main),e.open(e.editor.container)}))}}!function(e){e[e.Production=0]="Production",e[e.Localhost=1]="Localhost"}(D||(D={}));class B{constructor(){this.keys={w:!1,a:!1,s:!1,d:!1,e:!1,r:!1},this.mouse={x:0,y:0,left:!1,middle:!1,right:!1},this.playerAngle=0,this.appVariant="localhost"===window.location.hostname?D.Localhost:D.Production,this.myHtmlElements=new O,this.canvas=document.getElementsByTagName("canvas")[0],this.appVariant===D.Localhost?this.socket=io.connect("http://localhost:8000"):this.socket=io.connect(),this.serverClientSync=new P,this.editor=new L(this.myHtmlElements,this.socket),this.model=new G(this.mouse,this.socket,this.serverClientSync,this.myHtmlElements,this.editor),window.addEventListener("resize",(()=>{this.model.view.screenResize();const e=new Event("mousemove");this.canvas.dispatchEvent(e)})),window.addEventListener("beforeunload",(e=>{e.preventDefault(),e.returnValue=""})),this.keysController(),this.mouseController(),this.socketController(),this.menuController()}static run(){if(B.instance)throw new Error("Only one controller!");B.instance=new B}changePlayerName(){const e=this.myHtmlElements;let t=!1;e.mainMenu.name.value.length&&(t=!0,localStorage.setItem("playerName",e.mainMenu.name.value)),e.mainMenu.create.disabled=!t,e.mainMenu.maps.disabled=!t;let n=!1;e.mainMenu.games.value&&(n=!0);let s=!0;t&&n&&(s=!1),e.mainMenu.join.disabled=s,e.mainMenu.games.disabled=s}socketController(){const e=this.myHtmlElements;this.socket.on("debug",(e=>{console.log("debug:",e)})),this.socket.on("winner",(e=>{this.model.view.gameOver(e,!0)})),this.socket.on("loser",(e=>{this.model.view.gameOver(e,!1)})),this.socket.on("stopGame",(()=>{this.model.stop()})),this.socket.on("stopSpectate",((e,t)=>{this.model.view.gameOver(e,!0,t)})),this.socket.on("startGame",(t=>{this.model.map.openMap(t),this.model.gameStart(),e.close(e.lobbyMenu.main),setTimeout((()=>{e.close(e.hideGame)}),100)})),this.socket.on("playerId",(e=>{this.model.setPlayerId(e)})),this.socket.on("createGame",((t,n,s)=>{this.model.setGameId(t),e.lobbyMenu.mapName.textContent=s,e.close(e.mainMenu.main,e.lobbyMenu.forJoinPlayers),e.open(e.lobbyMenu.main,e.lobbyMenu.forCreatePlayer)})),this.socket.on("joinGame",((t,n,s)=>{this.model.setGameId(t),e.lobbyMenu.mapName.textContent=s,e.close(e.mainMenu.main,e.lobbyMenu.forCreatePlayer),e.open(e.lobbyMenu.main,e.lobbyMenu.forJoinPlayers)})),this.socket.on("leaveLobby",(()=>{this.model.setGameId(-1),e.close(e.lobbyMenu.main),e.open(e.mainMenu.main)})),this.socket.on("cancelLobby",(()=>{this.model.setGameId(-1),e.close(e.lobbyMenu.main),e.open(e.gameCanceledMenu.main)})),this.socket.on("updateListOpenGames",(t=>{e.mainMenu.games.innerHTML="";for(const n of t){const t=document.createElement("option");t.textContent=n.name+"'s game",t.setAttribute("value",n.index.toString()),e.mainMenu.games.appendChild(t)}t.length&&e.mainMenu.name.value.length?(e.mainMenu.games.disabled=!1,e.mainMenu.join.disabled=!1):(e.mainMenu.games.disabled=!0,e.mainMenu.join.disabled=!0)})),this.socket.on("listOfPlayers",(t=>{e.lobbyMenu.gameName.textContent=t[0]+"'s game",e.lobbyMenu.players.innerHTML="";for(const n of t){const t=document.createElement("li");t.textContent=n,e.lobbyMenu.players.appendChild(t)}})),this.socket.on("collisionPoints",((e,t,n)=>{this.model.collisionPoints.setData(e,t,n)})),this.socket.on("sendMap",(e=>{this.model.map.openMap(e)})),this.socket.on("mapSaved",(()=>{e.close(e.mapEditorMenu.main,e.editor.container),e.open(e.saveMapMenu.main),this.editor.close()})),this.socket.on("listOfMaps",(t=>{e.openMapMenu.maps.innerHTML="",e.mainMenu.maps.innerHTML="";for(const n of t){const t=document.createElement("option");t.setAttribute("value",n),t.textContent=n,e.mainMenu.maps.appendChild(t);const s=t.cloneNode(!0);e.openMapMenu.maps.appendChild(s)}})),this.socket.on("createPlayer",(e=>{e?this.model.setName(e):console.log("err: created player")})),this.socket.on("serverClientSync",((e,t)=>{const n=Date.now(),s=n-e;console.log("serverClientSync ping:",s);const i=t-(n-s/2);this.serverClientSync.addData(s,i)})),this.socket.on("u",(e=>{this.model.snapshotManager.addSnapshot(e)}))}mouseController(){document.addEventListener("contextmenu",(function(e){e.preventDefault()})),document.addEventListener("mousedown",(function(e){2===e.which&&e.preventDefault()})),this.myHtmlElements.transparentLayer.addEventListener("mousemove",(e=>{if(!this.model.gameActive())return;null==e.x?(this.mouse.x=this.canvas.width/2,this.mouse.y=this.canvas.height/2):(this.mouse.x=e.x,this.mouse.y=e.y);const t=this.playerAngle;this.rotatePlayer(this.mouse.x,this.mouse.y),this.playerAngle!==t&&this.socket.emit("a",this.model.getGameId(),this.playerAngle)})),this.myHtmlElements.transparentLayer.addEventListener("mousedown",(e=>{if(!this.model.gameActive())return;this.mouse.left=!0;const t=new g(e.clientX,e.clientY),n=this.model.view.calculateServerPosition(t);this.socket.emit("m",this.model.getGameId(),"l",n)})),this.myHtmlElements.transparentLayer.addEventListener("mouseup",(e=>{this.model.gameActive()&&(this.mouse.left=!1,this.socket.emit("m",this.model.getGameId(),"-l"))})),this.myHtmlElements.transparentLayer.addEventListener("wheel",(e=>{if(!this.model.gameActive())return;const t=e.deltaY<0?-1:1;this.model.spectate?this.socket.emit("wheelChangeSpectate",this.model.getGameId(),t):this.socket.emit("wheelChangeInventory",this.model.getGameId(),t)}))}rotatePlayer(e,t){const n=this.canvas.width/2,s=this.canvas.height/2;let i=n-e,a=s-t;0===i&&(i=.1);let o=Math.abs(180*Math.atan(i/a)/Math.PI);e>=n&&t<s&&(this.playerAngle=o),e>=n&&t>=s&&(this.playerAngle=180-o),e<n&&t>=s&&(this.playerAngle=180+o),e<n&&t<s&&(this.playerAngle=360-o),this.playerAngle=Math.round(this.playerAngle),360===this.playerAngle&&(this.playerAngle=0)}keysController(){document.addEventListener("keydown",(e=>{if(27===e.which&&(this.model.gameActive()||this.model.getSpectate())&&(this.myHtmlElements.escFromGameMenu.main.style.display="block"),this.model.gameActive())switch(e.which){case 87:this.keys.w||this.socket.emit("c",this.model.getGameId(),"u"),this.keys.w=!0;break;case 65:this.keys.a||this.socket.emit("c",this.model.getGameId(),"l"),this.keys.a=!0;break;case 83:this.keys.s||this.socket.emit("c",this.model.getGameId(),"d"),this.keys.s=!0;break;case 68:this.keys.d||this.socket.emit("c",this.model.getGameId(),"r"),this.keys.d=!0;break;case 69:this.keys.e||this.socket.emit("c",this.model.getGameId(),"e"),this.keys.e=!0;break;case 82:this.keys.e||this.socket.emit("c",this.model.getGameId(),"re"),this.keys.r=!0;break;case 48:this.socket.emit("i",this.model.getGameId(),0);break;case 49:this.socket.emit("i",this.model.getGameId(),1);break;case 50:this.socket.emit("i",this.model.getGameId(),2);break;case 51:this.socket.emit("i",this.model.getGameId(),3);break;case 52:this.socket.emit("i",this.model.getGameId(),4);break;case 53:this.socket.emit("i",this.model.getGameId(),5);break;case 54:this.socket.emit("i",this.model.getGameId(),6);break;case 55:this.socket.emit("i",this.model.getGameId(),7);break;case 56:this.socket.emit("i",this.model.getGameId(),8)}})),document.addEventListener("keyup",(e=>{if(this.model.gameActive())switch(e.which){case 87:this.keys.w&&this.socket.emit("c",this.model.getGameId(),"-u"),this.keys.w=!1;break;case 65:this.keys.a&&this.socket.emit("c",this.model.getGameId(),"-l"),this.keys.a=!1;break;case 83:this.keys.s&&this.socket.emit("c",this.model.getGameId(),"-d"),this.keys.s=!1;break;case 68:this.keys.d&&this.socket.emit("c",this.model.getGameId(),"-r"),this.keys.d=!1;break;case 69:this.keys.e=!1;break;case 82:this.keys.r=!1}}))}menuController(){const e=this.myHtmlElements;localStorage.getItem("playerName")&&(e.mainMenu.name.value=localStorage.getItem("playerName"),this.changePlayerName()),e.escFromGameMenu.back.addEventListener("click",(()=>{e.escFromGameMenu.main.style.display="none"})),e.escFromGameMenu.leave.addEventListener("click",(()=>{e.escFromGameMenu.main.style.display="none",this.socket.emit("leaveGame",this.model.getGameId()),this.model.reset()})),e.gameOverMenu.back.addEventListener("click",(()=>{this.socket.emit("leaveGame",this.model.getGameId()),this.model.reset()})),e.gameOverMenu.spectate.addEventListener("click",(()=>{this.socket.emit("spectate",this.model.getGameId()),e.close(e.gameOverMenu.main),this.model.startSpectate()})),e.mapSizeMenu.ok.addEventListener("click",(()=>{this.editor.changeSize(parseInt(document.getElementById("mapSizeValue").value)),e.open(e.editor.container),e.close(e.mapSizeMenu.main)})),e.mapSizeMenu.back.addEventListener("click",(()=>{e.close(e.mapSizeMenu.main),this.editor.isActive()?e.open(e.mapEditorMenu.main):e.open(e.mapMenu.main)})),e.mapMenu.create.addEventListener("click",(()=>{this.editor.create(),e.close(e.mapMenu.main),e.open(e.mapSizeMenu.main)})),e.mapMenu.open.addEventListener("click",(()=>{e.close(e.mapMenu.main),e.open(e.openMapMenu.main)})),e.mapMenu.back.addEventListener("click",(()=>{e.close(e.mapMenu.main),e.open(e.mainMenu.main)})),e.openMapMenu.back.addEventListener("click",(()=>{e.close(e.openMapMenu.main),e.open(e.mapMenu.main)})),e.openMapMenu.ok.addEventListener("click",(()=>{const t=e.openMapMenu.maps.value;this.socket.emit("openMapInEditor",t)})),e.editor.openMenu.addEventListener("click",(()=>{e.open(e.mapEditorMenu.main)})),e.mapEditorMenu.back.addEventListener("click",(()=>{e.close(e.mapEditorMenu.main)})),e.mapEditorMenu.close.addEventListener("click",(()=>{e.close(e.mapEditorMenu.main,e.editor.container),e.open(e.mainMenu.main),this.editor.close()})),e.mapEditorMenu.save.addEventListener("click",(()=>{const t=this.editor.getMapData(),n=e.mapEditorMenu.name.value;this.model.isNameOk(n)?this.socket.emit("editorSaveMap",n,t):e.open(e.alertMenu.main)})),e.mapEditorMenu.changeSize.addEventListener("click",(()=>{e.close(e.mapEditorMenu.main),e.open(e.mapSizeMenu.main)})),e.saveMapMenu.back.addEventListener("click",(()=>{e.close(e.saveMapMenu.main),e.open(e.mainMenu.main)})),e.mainMenu.openEditor.addEventListener("click",(()=>{e.open(e.mapMenu.main),e.close(e.mainMenu.main)})),e.mainMenu.name.addEventListener("input",(()=>{this.changePlayerName()})),e.mainMenu.create.addEventListener("click",(()=>{if(e.mainMenu.name.value.length){const t=e.mainMenu.name.value,n=e.mainMenu.maps.value;this.model.isNameOk(t)?this.socket.emit("createGame",t,n):e.open(e.alertMenu.main)}})),e.mainMenu.join.addEventListener("click",(()=>{if(e.mainMenu.name.value.length&&e.mainMenu.games.value){const t=e.mainMenu.name.value,n=parseInt(e.mainMenu.games.value);this.model.isNameOk(t)?this.socket.emit("joinGame",t,n):e.open(e.alertMenu.main)}})),e.gameCanceledMenu.back.addEventListener("click",(()=>{e.close(e.gameCanceledMenu.main),e.open(e.mainMenu.main)})),e.mainMenu.controls.addEventListener("click",(()=>{e.open(e.controlsMenu.main),e.close(e.mainMenu.main)})),e.alertMenu.ok.addEventListener("click",(()=>{e.close(e.alertMenu.main)})),e.lobbyMenu.leave.addEventListener("click",(()=>{this.socket.emit("leaveLobby",this.model.getGameId())})),e.lobbyMenu.cancel.addEventListener("click",(()=>{this.socket.emit("cancelLobby",this.model.getGameId())})),e.lobbyMenu.start.addEventListener("click",(()=>{e.close(e.lobbyMenu.main),this.socket.emit("startGame",this.model.getGameId())})),e.controlsMenu.back.addEventListener("click",(()=>{e.open(e.mainMenu.main),e.close(e.controlsMenu.main)}))}}B.run(),console.log("Version: 1.0.1")})()})();
//# sourceMappingURL=app.js.map